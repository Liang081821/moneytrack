import{r as a,j as e}from"./react-DrNrPb_Q.js";import{c as _t}from"./react-dom-DnkMH0ii.js";import{N as Le,B as Zt}from"./react-router-dom-C0pEP87T.js";import{P as w}from"./prop-types-DKB6m3M1.js";import{i as Jt,a as Gt,p as Ut,g as Yt,b as Qt,c as Kt,d as Se,e as ie,o as Ne,G as at,s as nt,u as xe,f as Me,h as Xt,j as es,k as ts,l as ss,q as oe,w as _,m as ae,n as ye,t as ge,v as rs,x as as,y as ns,z as lt}from"./@firebase-BucOjXz9.js";import"./firebase-Dtu-ImgV.js";import{D as ot}from"./react-datepicker-CX8anPtV.js";import{u as Ae}from"./react-hook-form-DpHm-NjD.js";import{d as ls,O as os,e as it,f as is,g as ve}from"./react-router-BCDvPyod.js";import{r as et}from"./react-grid-layout-K1UVlJM_.js";import{S as K}from"./react-loading-skeleton-CVQEOWmn.js";import"./react-resizable-BXL1tzZB.js";import{c as Ee}from"./react-joyride-CZZaG7ih.js";import{C as Be,j as _e,A as cs,p as ds,k as xs,B as ms,l as us,n as fs}from"./chart.js-DFz4ndfv.js";import{D as ct,L as dt,P as xt,B as tt}from"./react-chartjs-2-CyvlJ1hx.js";import{p as $e}from"./chartjs-plugin-datalabels-CdiGUQc-.js";import{p as mt}from"./chartjs-plugin-zoom-C1DIiS9N.js";import{c as hs}from"./clsx-D-KgLtcR.js";import{t as gs}from"./tailwind-merge-BOZU2X2x.js";import{u as st}from"./react-intersection-observer-BSj3fkY4.js";import{u as ps}from"./embla-carousel-react-lSj6E-_W.js";import{S as js}from"./@radix-ui-lYVXG3lU.js";import{c as bs}from"./class-variance-authority-Bb4qSo10.js";import{A as vs,a as ws}from"./lucide-react-BMDkpGoF.js";import{M as ys}from"./react-tooltip-D1CnTztG.js";import"./classnames-DaESv1PK.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-D_05oOQ-.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./react-onclickoutside-DKg6_7Wi.js";import"./@floating-ui-C1ZT29UE.js";import"./fast-equals-Bo_I6jOO.js";import"./react-draggable-Bvdo4PNg.js";import"./resize-observer-polyfill-DxOACxYk.js";import"./@gilbarbara-CQoQLGZn.js";import"./is-lite-Ce_qFKpb.js";import"./tree-changes-fs5NfJf2.js";import"./scroll-DRq-57qf.js";import"./scrollparent-E9squWda.js";import"./deepmerge-DkpI02Ha.js";import"./react-floater-tpFYg1HQ.js";import"./popper.js-CCzXKaxK.js";import"./react-innertext-DjuLpetl.js";import"./@kurkle-BZxJdD1U.js";import"./hammerjs-BLGm6HXy.js";import"./embla-carousel-reactive-utils-DkegjUUZ.js";import"./embla-carousel-v-CXq_RL.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function l(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?t.credentials="include":n.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(n){if(n.ep)return;n.ep=!0;const t=l(n);fetch(n.href,t)}})();const Ns={apiKey:"AIzaSyDK1C4yJi79M1QM8I_IwhMq5qO5x-yiLZA",authDomain:"moneytrack-4c04d.firebaseapp.com",projectId:"moneytrack-4c04d",storageBucket:"moneytrack-4c04d.appspot.com",messagingSenderId:"749760221507",appId:"1:749760221507:web:1647083a1392791d26dff6",measurementId:"G-TJVVE6SQ08"},Ze=Jt(Ns),de=Gt(Ze,{localCache:Ut({tabManager:Kt()})}),Cs=Yt(Ze),De=Qt(Ze),ne=s=>{if(!s)return console.error("loginEmail is undefined or null"),{};const r=Se(de,"record",s,"accounting"),l=Se(de,"record",s,"property"),i=Se(de,"record",s,"project"),n=Se(de,"record",s,"report"),t=Se(de,"record",s,"history"),c=ie(de,"record",s);return{accountingCollectionRef:r,propertyCollectionRef:l,historyCollectionRef:t,projectCollectionRef:i,reportCollectionRef:n,docRef:c}},ks=(s,r)=>{const{docRef:l}=ne(s);try{return Ne(l,n=>{n.exists()?r(n.data()):r(null)})}catch(i){console.error("Error fetching document:",i)}},Ss=(s,r)=>{const{projectCollectionRef:l}=ne(s);try{return Ne(l,n=>{const t=n.docs.map(c=>({id:c.id,...c.data()}));r(t)})}catch(i){console.error("Error fetching documents:",i)}},ut=(s,r)=>{const{accountingCollectionRef:l}=ne(s);try{return Ne(l,n=>{const t=n.docs.map(c=>({id:c.id,...c.data()}));r(t)})}catch(i){console.error("Error fetching documents:",i)}},Ds=(s,r)=>{const{propertyCollectionRef:l}=ne(s);try{return Ne(l,n=>{const t=n.docs.map(c=>({id:c.id,...c.data()}));r(t)})}catch(i){console.error("Error fetching documents:",i)}},As=(s,r)=>{const{historyCollectionRef:l}=ne(s);try{return Ne(l,n=>{const t=n.docs.map(c=>({id:c.id,...c.data()}));r(t)})}catch(i){console.error("Error fetching history records:",i)}},Ts=(s,r)=>{const{reportCollectionRef:l}=ne(s);try{return Ne(l,n=>{const t=n.docs.map(c=>({id:c.id,...c.data()}));r(t)})}catch(i){console.error("Error fetching history records:",i)}},ft=a.createContext(),ht=({children:s})=>{const[r,l]=a.useState(!1),[i,n]=a.useState([]),[t,c]=a.useState([]),[m,o]=a.useState([]),[x,u]=a.useState([]),[D,d]=a.useState([]),[f,p]=a.useState([]),[N,C]=a.useState(()=>localStorage.getItem("user")||null),[h,j]=a.useState(()=>localStorage.getItem("userEmail")||null);a.useEffect(()=>{const k=Ds(h,n);return()=>k()},[h]),a.useEffect(()=>{const k=Ts(h,u);return()=>k()},[h]),a.useEffect(()=>{const k=ks(h,c);return()=>k()},[h]),a.useEffect(()=>{const k=Ss(h,o);return()=>k()},[h]),a.useEffect(()=>{const k=As(h,d);return()=>k()},[h]),a.useEffect(()=>{const k=ut(h,p);return()=>k()},[h]);const R="ddf9c17c8cf64531954c5829d70d99d3",[T,M]=a.useState([]),O=["TWD","USD","EUR","JPY","GBP","AUD"],[A,b]=a.useState({});return a.useEffect(()=>{(async()=>{try{const[E,I]=await Promise.all([fetch(`https://openexchangerates.org/api/currencies.json?app_id=${R}`),fetch(`https://openexchangerates.org/api/latest.json?app_id=${R}`)]);if(!E.ok||!I.ok)throw new Error("Network response was not ok");const V=await E.json(),Z=await I.json(),H=Object.entries(V).filter(([J])=>O.includes(J));M(H),b(Z.rates)}catch(E){console.error("Error fetching currency list:",E)}})()},[R]),ht.propTypes={children:w.node.isRequired},e.jsx(ft.Provider,{value:{property:i,setProperty:n,classData:t,setClassData:c,historyData:D,setHistoryData:d,transactionData:f,setTransactionData:p,loginState:N,setLoginState:C,loginEmail:h,setLoginEmail:j,projectData:m,setProjectData:o,reportData:x,currencies:T,setCurrencies:M,rates:A,setRates:b,accounting:r,setAccounting:l},children:s})},P=()=>a.useContext(ft),Ls="/assets/google-DZYQsEk7.png",rt="/assets/Logo-Bli-s0Lo.png";function Je({linkToBackstage:s=!0}){const{loginState:r,loginEmail:l}=P(),[i,n]=a.useState(!1),[t,c]=a.useState(!1),[m,o]=a.useState(!0),[x,u]=a.useState({name:"",email:"test123@gmail.com",password:"test123"}),D=()=>{window.scrollY>50?n(!0):n(!1)};a.useEffect(()=>(window.addEventListener("scroll",D),()=>{window.removeEventListener("scroll",D)}),[]);const d=async()=>{const R=new at;try{const M=(await nt(De,R)).user,O=M.email,A=ie(de,"record",O);try{await xe(A,{createdAt:new Date,userEmail:O})}catch(b){b.code==="not-found"?await Me(A,{createdAt:new Date,userEmail:O}):console.error("更新失敗",b)}localStorage.setItem("userEmail",O),localStorage.setItem("user",M.displayName),window.location.href="/property"}catch(T){console.error("登入失敗",T)}},f=async()=>{try{await De.signOut(),localStorage.removeItem("userEmail"),localStorage.removeItem("user"),window.location.href="/"}catch(R){console.error("登出失敗",R)}},p=()=>{c(!0)},N=()=>{c(!1),o(!1)},C=async R=>{R.preventDefault();try{await Xt(De,x.email,x.password);const T=x.email,M=ie(de,"record",T);await Me(M,{name:x.name,userEmail:x.email,createdAt:new Date}),localStorage.setItem("userEmail",x.email),localStorage.setItem("user",x.name),window.location.href="/property"}catch(T){console.error("註冊失敗",T)}},h=async R=>{R.preventDefault();try{const M=(await es(De,x.email,x.password)).user;localStorage.setItem("userEmail",M.email),localStorage.setItem("user",M.displayName||x.email),window.location.href="/property"}catch(T){console.error("登入失敗",T)}},j=()=>{window.location.href="/property"};return e.jsxs(e.Fragment,{children:[l?e.jsxs("div",{className:"fixed top-0 z-20 flex h-[80px] w-full items-center justify-between bg-[#222E50] p-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:rt,alt:"Logo",className:"flex h-[47px] w-[42px]"}),e.jsx("div",{className:"text-xs text-white xs:text-sm sm:text-base",children:"MoneyTrack"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"text-xs text-white xs:text-sm sm:text-base",children:["歡迎！",r]}),s&&e.jsx("button",{onClick:j,className:"rounded-lg border border-white p-2 text-xs text-white hover:bg-white hover:text-[#222E50] xs:text-sm sm:text-base",children:"進入後台"}),e.jsx("button",{onClick:f,className:"rounded-lg border border-white p-2 text-xs text-white hover:bg-white hover:text-[#222E50] xs:text-sm sm:text-base",children:"登出"})]})]}):e.jsx("div",{className:`fixed z-10 w-[100vw] ${i?"px-4 pt-4":""} transition-all duration-300`,children:e.jsxs("div",{className:`flex h-[80px] items-center justify-between p-6 ${i?"rounded-2xl bg-[#222E50]":""} transition-all duration-300`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:rt,alt:"Logo",className:"flex h-[47px] w-[42px]"}),e.jsx("div",{className:"text-xs text-white xs:text-sm sm:text-base",children:"MoneyTrack"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:p,className:"rounded-lg border border-white p-2 text-xs text-white hover:bg-white hover:text-[#222E50] xs:text-sm sm:text-base",children:"註冊/登入"}),e.jsx("button",{onClick:d,className:"h-[42px] w-[42px] rounded-lg border border-white p-2 text-xs text-white hover:bg-white hover:text-[#222E50] xs:text-sm sm:text-base",children:e.jsx("div",{className:"",children:e.jsx("img",{src:Ls,alt:""})})})]})]})}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"w-[40vw] rounded-lg bg-white p-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:m?"登入":"註冊"}),e.jsxs("form",{onSubmit:m?h:C,children:[!m&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"name",className:"block text-lg font-medium text-gray-700",children:"姓名"}),e.jsx("input",{type:"text",id:"name",value:x.name,onChange:R=>u({...x,name:R.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-lg",required:!m})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-lg font-medium text-gray-700",children:"電子郵件"}),e.jsx("input",{type:"email",id:"email",value:x.email,onChange:R=>u({...x,email:R.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-lg",required:!0})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{htmlFor:"password",className:"block text-lg font-medium text-gray-700",children:"密碼"}),e.jsx("input",{type:"password",id:"password",value:x.password,onChange:R=>u({...x,password:R.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-lg",required:!0})]}),e.jsxs("div",{className:"mt-6 flex justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>o(!m),className:"text-lg text-blue-500 hover:underline",children:m?"沒有帳戶？ 註冊":"已有帳戶？ 登入"}),e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:N,className:"rounded-lg px-4 py-2 text-lg text-gray-700",children:"取消"}),e.jsx("button",{type:"submit",className:"ml-2 rounded-lg bg-[#607196] px-4 py-2 text-lg text-white hover:bg-indigo-700",children:m?"登入":"註冊"})]})]})]})]})})]})}Je.propTypes={linkToBackstage:w.bool};function Rs(){const[s,r]=a.useState(!0),l=()=>{r(!0)},i=()=>{r(!1)},n=()=>{window.innerWidth<768&&r(!0)};return a.useEffect(()=>{const t=()=>{window.innerWidth>=768?r(!1):r(!0)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),e.jsx(e.Fragment,{children:e.jsx("div",{className:`fixed h-[100vh] rounded-r-xl p-1 py-3 transition-all duration-300 ease-in md:relative md:h-auto md:rounded-r-none md:bg-[#bfbfbf] md:px-3 ${s?"":"z-10 flex min-w-48 flex-col gap-8 bg-white px-3"} `,children:s?e.jsx(e.Fragment,{children:e.jsx("div",{className:"sticky top-[84px] flex flex-col gap-6",children:e.jsx("button",{className:"h-10 rounded-lg p-2",onClick:i,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-xl-heavy",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.85719 3H15.1428C16.2266 2.99999 17.1007 2.99998 17.8086 3.05782C18.5375 3.11737 19.1777 3.24318 19.77 3.54497C20.7108 4.02433 21.4757 4.78924 21.955 5.73005C22.2568 6.32234 22.3826 6.96253 22.4422 7.69138C22.5 8.39925 22.5 9.27339 22.5 10.3572V13.6428C22.5 14.7266 22.5 15.6008 22.4422 16.3086C22.3826 17.0375 22.2568 17.6777 21.955 18.27C21.4757 19.2108 20.7108 19.9757 19.77 20.455C19.1777 20.7568 18.5375 20.8826 17.8086 20.9422C17.1008 21 16.2266 21 15.1428 21H8.85717C7.77339 21 6.89925 21 6.19138 20.9422C5.46253 20.8826 4.82234 20.7568 4.23005 20.455C3.28924 19.9757 2.52433 19.2108 2.04497 18.27C1.74318 17.6777 1.61737 17.0375 1.55782 16.3086C1.49998 15.6007 1.49999 14.7266 1.5 13.6428V10.3572C1.49999 9.27341 1.49998 8.39926 1.55782 7.69138C1.61737 6.96253 1.74318 6.32234 2.04497 5.73005C2.52433 4.78924 3.28924 4.02433 4.23005 3.54497C4.82234 3.24318 5.46253 3.11737 6.19138 3.05782C6.89926 2.99998 7.77341 2.99999 8.85719 3ZM6.35424 5.05118C5.74907 5.10062 5.40138 5.19279 5.13803 5.32698C4.57354 5.6146 4.1146 6.07354 3.82698 6.63803C3.69279 6.90138 3.60062 7.24907 3.55118 7.85424C3.50078 8.47108 3.5 9.26339 3.5 10.4V13.6C3.5 14.7366 3.50078 15.5289 3.55118 16.1458C3.60062 16.7509 3.69279 17.0986 3.82698 17.362C4.1146 17.9265 4.57354 18.3854 5.13803 18.673C5.40138 18.8072 5.74907 18.8994 6.35424 18.9488C6.97108 18.9992 7.76339 19 8.9 19H9.5V5H8.9C7.76339 5 6.97108 5.00078 6.35424 5.05118ZM11.5 5V19H15.1C16.2366 19 17.0289 18.9992 17.6458 18.9488C18.2509 18.8994 18.5986 18.8072 18.862 18.673C19.4265 18.3854 19.8854 17.9265 20.173 17.362C20.3072 17.0986 20.3994 16.7509 20.4488 16.1458C20.4992 15.5289 20.5 14.7366 20.5 13.6V10.4C20.5 9.26339 20.4992 8.47108 20.4488 7.85424C20.3994 7.24907 20.3072 6.90138 20.173 6.63803C19.8854 6.07354 19.4265 5.6146 18.862 5.32698C18.5986 5.19279 18.2509 5.10062 17.6458 5.05118C17.0289 5.00078 16.2366 5 15.1 5H11.5ZM5 8.5C5 7.94772 5.44772 7.5 6 7.5H7C7.55229 7.5 8 7.94772 8 8.5C8 9.05229 7.55229 9.5 7 9.5H6C5.44772 9.5 5 9.05229 5 8.5ZM5 12C5 11.4477 5.44772 11 6 11H7C7.55229 11 8 11.4477 8 12C8 12.5523 7.55229 13 7 13H6C5.44772 13 5 12.5523 5 12Z",fill:"currentColor"})})})})}):e.jsxs("div",{className:"sticky top-[84px] flex flex-col gap-6 fade-in",children:[e.jsx("button",{className:"h-10 rounded-lg p-2",onClick:l,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-xl-heavy",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.85719 3H15.1428C16.2266 2.99999 17.1007 2.99998 17.8086 3.05782C18.5375 3.11737 19.1777 3.24318 19.77 3.54497C20.7108 4.02433 21.4757 4.78924 21.955 5.73005C22.2568 6.32234 22.3826 6.96253 22.4422 7.69138C22.5 8.39925 22.5 9.27339 22.5 10.3572V13.6428C22.5 14.7266 22.5 15.6008 22.4422 16.3086C22.3826 17.0375 22.2568 17.6777 21.955 18.27C21.4757 19.2108 20.7108 19.9757 19.77 20.455C19.1777 20.7568 18.5375 20.8826 17.8086 20.9422C17.1008 21 16.2266 21 15.1428 21H8.85717C7.77339 21 6.89925 21 6.19138 20.9422C5.46253 20.8826 4.82234 20.7568 4.23005 20.455C3.28924 19.9757 2.52433 19.2108 2.04497 18.27C1.74318 17.6777 1.61737 17.0375 1.55782 16.3086C1.49998 15.6007 1.49999 14.7266 1.5 13.6428V10.3572C1.49999 9.27341 1.49998 8.39926 1.55782 7.69138C1.61737 6.96253 1.74318 6.32234 2.04497 5.73005C2.52433 4.78924 3.28924 4.02433 4.23005 3.54497C4.82234 3.24318 5.46253 3.11737 6.19138 3.05782C6.89926 2.99998 7.77341 2.99999 8.85719 3ZM6.35424 5.05118C5.74907 5.10062 5.40138 5.19279 5.13803 5.32698C4.57354 5.6146 4.1146 6.07354 3.82698 6.63803C3.69279 6.90138 3.60062 7.24907 3.55118 7.85424C3.50078 8.47108 3.5 9.26339 3.5 10.4V13.6C3.5 14.7366 3.50078 15.5289 3.55118 16.1458C3.60062 16.7509 3.69279 17.0986 3.82698 17.362C4.1146 17.9265 4.57354 18.3854 5.13803 18.673C5.40138 18.8072 5.74907 18.8994 6.35424 18.9488C6.97108 18.9992 7.76339 19 8.9 19H9.5V5H8.9C7.76339 5 6.97108 5.00078 6.35424 5.05118ZM11.5 5V19H15.1C16.2366 19 17.0289 18.9992 17.6458 18.9488C18.2509 18.8994 18.5986 18.8072 18.862 18.673C19.4265 18.3854 19.8854 17.9265 20.173 17.362C20.3072 17.0986 20.3994 16.7509 20.4488 16.1458C20.4992 15.5289 20.5 14.7366 20.5 13.6V10.4C20.5 9.26339 20.4992 8.47108 20.4488 7.85424C20.3994 7.24907 20.3072 6.90138 20.173 6.63803C19.8854 6.07354 19.4265 5.6146 18.862 5.32698C18.5986 5.19279 18.2509 5.10062 17.6458 5.05118C17.0289 5.00078 16.2366 5 15.1 5H11.5ZM5 8.5C5 7.94772 5.44772 7.5 6 7.5H7C7.55229 7.5 8 7.94772 8 8.5C8 9.05229 7.55229 9.5 7 9.5H6C5.44772 9.5 5 9.05229 5 8.5ZM5 12C5 11.4477 5.44772 11 6 11H7C7.55229 11 8 11.4477 8 12C8 12.5523 7.55229 13 7 13H6C5.44772 13 5 12.5523 5 12Z",fill:"currentColor"})})}),e.jsxs(e.Fragment,{children:[e.jsx(Le,{to:"/property",onClick:n,className:({isActive:t,isPending:c,isTransitioning:m})=>`transform transition-all duration-300 ${t?"font-2xl scale-105 rounded-lg bg-[#e3e3e3]":"scale-100 bg-transparent font-normal opacity-80"} ${c?"text-red-500":"text-black"} ${m?"transition-transform duration-300":""} p-2`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z"})}),e.jsx("h1",{children:"帳戶整合"})]})}),e.jsx(Le,{to:"/accounting",onClick:n,className:({isActive:t,isPending:c,isTransitioning:m})=>`transform transition-all duration-300 ${t?"font-2xl scale-105 rounded-lg bg-[#e3e3e3]":"scale-100 bg-transparent font-normal opacity-80"}  ${m?"transition-transform duration-300":""} p-2`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),e.jsx("h1",{children:"數據圖表"})]})}),e.jsx(Le,{to:"/analysis",onClick:n,className:({isActive:t,isPending:c,isTransitioning:m})=>`transform transition-all duration-300 ${t?"font-2xl scale-105 rounded-lg bg-[#e3e3e3]":"scale-100 bg-transparent font-normal opacity-80"} ${c?"text-red-500":"text-black"} ${m?"transition-transform duration-300":""} p-2`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z"})]}),e.jsx("h1",{children:"財務分析"})]})}),e.jsx(Le,{to:"/project",onClick:n,className:({isActive:t,isPending:c,isTransitioning:m})=>`transform transition-all duration-300 ${t?"font-2xl scale-105 rounded-lg bg-[#e3e3e3] opacity-100":"scale-100 bg-transparent font-normal opacity-80"} ${c?"text-red-500":"text-black"} ${m?"transition-transform duration-300":""} p-2`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),e.jsx("h1",{children:"理財專案"})]})})]})]})})})}const F=({children:s,onClick:r,variant:l="default",className:i="",...n})=>{const t="rounded-lg px-2 py-1  md:px-4 md:py-2  font-semibold transition duration-200",c={delete:"bg-[#89023E] hover:bg-[#CC7178] text-white",add:"bg-[#babfd1] text-gray-800",retain:"bg-[#607196] text-white",grey:"bg-[#aaaaaa] text-white",prevstep:"bg-gray-300",dontdelete:"bg-[#9DBEBB] text-white",default:""};return e.jsx("button",{onClick:r,className:`${t} ${c[l]} ${i}`,...n,children:s})};F.propTypes={children:w.node.isRequired,onClick:w.func.isRequired,variant:w.oneOf(["default","delete","secondary"]),className:w.string};function Fe({message:s,onConfirm:r,onCancel:l,cancelMessage:i,confirmMessage:n}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75",children:e.jsxs("div",{className:"relative w-[90%] max-w-md rounded-lg bg-white p-6 shadow-lg",children:[e.jsx("p",{className:"mb-4 text-xl font-semibold",children:s}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(F,{onClick:l,className:"flex-1",children:i}),e.jsx(F,{onClick:r,className:"flex-1",variant:"retain",children:n})]})]})})}Fe.propTypes={message:w.string.isRequired,onConfirm:w.func.isRequired,onCancel:w.func.isRequired,cancelMessage:w.string.isRequired,confirmMessage:w.string.isRequired};function he({message:s,onClose:r}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75 fade-in",children:e.jsxs("div",{className:"relative w-[90%] max-w-md rounded-lg bg-white p-6 shadow-lg",children:[e.jsx("p",{className:"mb-4 text-xl font-semibold",children:s}),e.jsx(F,{onClick:r,className:"w-full",variant:"retain",children:"確定"})]})})}he.propTypes={message:w.string.isRequired,onClose:w.func.isRequired};function gt({newclassEditing:s,setNewClassEditing:r}){const[l,i]=a.useState(!1),{loginEmail:n}=P(),{docRef:t}=ne(n),[c,m]=a.useState(null),[o,x]=a.useState({isOpen:!1,message:"",onConfirm:null,cancelMessage:"取消",confirmMessage:"確認"}),[u,D]=a.useState("收入"),{classData:d}=P(),{register:f,handleSubmit:p,reset:N,formState:{errors:C}}=Ae({defaultValues:{class:""}}),h=()=>{r(!0)},j=()=>{r(!1)},R=async b=>{try{const k=u==="收入"?"income":"expense";N(),i(!1),m("新增成功"),await xe(t,{[k]:ts(b.class)})}catch(k){console.error("Error adding document: ",k)}},T=()=>{i(!0)},M=()=>{i(!1),N()},O=async b=>{try{const k=u==="收入"?"income":"expense";m("刪除成功"),await xe(t,{[k]:ss(b)})}catch(k){console.error("Error removing document: ",k)}},A=u==="收入"?(d==null?void 0:d.income)||[]:(d==null?void 0:d.expense)||[];return gt.propTypes={newclassEditing:w.bool.isRequired,setNewClassEditing:w.func.isRequired},e.jsxs("div",{className:`self-end rounded-lg bg-[#607196] px-4 py-2 text-center font-semibold transition-all ${s?"":"overflow-hidden text-white"}`,children:[c&&e.jsx(he,{message:c,onClose:()=>m(null)}),o.isOpen&&e.jsx(Fe,{message:o.message,onConfirm:()=>{o.onConfirm(),x({...o,isOpen:!1})},onCancel:()=>x({...o,isOpen:!1}),cancelMessage:o.cancelMessage,confirmMessage:o.confirmMessage}),e.jsx("button",{onClick:h,children:"管理分類"}),s&&e.jsxs("div",{className:"fixed inset-0 z-10 flex items-center justify-center bg-gray-800 bg-opacity-75",children:[e.jsx("div",{className:"relative flex h-[30vh] w-[90%] max-w-lg flex-col gap-3 rounded-lg bg-white p-8",children:!l&&e.jsxs("div",{className:"flex flex-col items-center gap-8",children:[e.jsxs("div",{className:"flex w-full justify-evenly border-b border-gray-300",children:[e.jsx("div",{className:`grow transform cursor-pointer text-center transition-all duration-300 ease-in-out ${u==="收入"?"scale-105 border-b-2 border-[#82A0BC] text-[#82A0BC]":"text-gray-400"} p-1`,onClick:()=>D("收入"),children:"收入"}),e.jsx("div",{className:`grow transform cursor-pointer text-center transition-all duration-300 ease-in-out ${u==="支出"?"scale-105 border-b-2 border-[#82A0BC] text-[#82A0BC]":"text-gray-400"} p-1`,onClick:()=>D("支出"),children:"支出"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 self-start overflow-scroll",children:[Array.isArray(A)&&A.map((b,k)=>e.jsxs("div",{className:"flex items-center justify-start rounded-lg border border-gray-300 p-2",children:[e.jsx("p",{children:b}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"ml-1 size-5 cursor-pointer",onClick:()=>{x({isOpen:!0,message:`確定要刪除「${b}」嗎？ 刪除後該紀錄仍會保留`,onConfirm:()=>O(b),cancelMessage:"取消",confirmMessage:"確認"})},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})]},k)),e.jsx(F,{variant:"add",onClick:T,children:"新增"})]}),e.jsx(F,{onClick:j,className:"absolute bottom-8 mt-10",variant:"retain",children:"編輯完成"})]})}),l&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center",children:e.jsx("div",{className:"relative flex w-[90%] max-w-lg flex-col gap-3 rounded-lg bg-white p-2",children:e.jsxs("form",{onSubmit:p(R),className:"flex items-center justify-between",children:[e.jsx("div",{className:"ml-2 text-nowrap rounded-lg bg-[#82A0BC] px-4 py-2 text-white",children:u}),e.jsx("input",{placeholder:C.class?C.class.message:"分類名稱",className:`rounded-lg border border-gray-300 px-4 py-2 ${C.class?"border-red-500":""}`,...f("class",{required:"請填寫分類名稱"})}),e.jsxs("div",{children:[e.jsx(F,{type:"submit",className:"ml-2",variant:"add",children:"新增"}),e.jsx(F,{onClick:M,className:"ml-2",children:"取消"})]})]})})})]})]})}function pt({setAccounting:s}){const{property:r,classData:l,projectData:i,currencies:n,rates:t}=P(),{loginEmail:c}=P(),m=ls(),[o,x]=a.useState({isOpen:!1,message:"",onConfirm:null,cancelMessage:"取消",confirmMessage:"確認"}),{accountingCollectionRef:u,propertyCollectionRef:D}=ne(c),{register:d,handleSubmit:f,watch:p,setValue:N,reset:C,formState:{errors:h}}=Ae({defaultValues:{account:"",type:"",class:"",targetaccount:"",currency:"TWD"}}),j=p("type"),R=p("account"),T=p("targetaccount"),M=p("currency","TWD"),O=p("amount"),A=l?l[j==="收入"?"income":j==="支出"?"expense":"transfer"]:[],[b,k]=a.useState([]);a.useEffect(()=>{const y=r?r.filter(v=>{const g=R?JSON.parse(R):null;return g?v.id!==g.id:!0}):[];k(y)},[r,R,N]),a.useEffect(()=>{const y=R?JSON.parse(R):null,v=T?JSON.parse(T):null;y&&v&&y.id===v.id&&N("targetaccount","")},[R,N,T]);const[E,I]=a.useState(0);a.useEffect(()=>{let y=O;if(M!=="TWD"&&O>0)if(t[M]&&t.TWD){const v=1/t[M],g=t.TWD;y=(O*v*g).toFixed(2)}else{alert("匯率資料不可用，無法轉換成 TWD");return}I(y)},[O,M,t]);const V=async y=>{try{const{amount:v,currency:g}=y;let L=v;if(g!=="TWD")if(t[g]&&t.TWD){const $=1/t[g],U=t.TWD;L=(v*$*U).toFixed(2)}else{alert("匯率資料不可用，無法轉換成 TWD");return}const S=y.account?JSON.parse(y.account):null,B=y.project?JSON.parse(y.project):null,q=y.targetaccount?JSON.parse(y.targetaccount):null,W=oe(D,_("id","==",S.id));if(y.targetaccount){const $=oe(D,_("id","==",q.id)),U=await ae($);U.empty||U.forEach(async te=>{const ue=te.data().balance||0,je=y.type==="轉帳"?ue+Number(L):ue;await xe(te.ref,{balance:je})})}const G=await ae(W);G.empty||G.forEach(async $=>{const U=$.data().balance||0,te=y.type==="收入"?U+Number(L):U-Number(L);await xe($.ref,{balance:te})});const z=G.empty?"":G.docs[0].data().account_type;try{x({isOpen:!0,message:"新增成功",onConfirm:()=>m("/accounting"),onCancel:()=>s(!1),cancelMessage:"再記一筆",confirmMessage:"確認"}),C(),j==="轉帳"?await ye(u,{account:S.account,accountid:S.id,account_type:z,targetaccountid:q.id,amount:Number(y.amount),time:Z,targetaccount:q.account,record_type:y.type,projectname:B?B.name:null,projectid:B?B.id:null,currency:y.currency,convertedAmountTWD:Number(L)}):await ye(u,{account:S.account,accountid:S.id,account_type:z,amount:Number(y.amount),time:Z,class:y.class,record_type:y.type,projectname:B?B.name:null,projectid:B?B.id:null,currency:y.currency,convertedAmountTWD:Number(L)})}catch($){console.error("寫入資料時出錯：",$)}}catch(v){console.error("Error adding document: ",v)}},[Z,H]=a.useState(new Date),J=()=>{s(!1)};pt.propTypes={setAccounting:w.func.isRequired};const re=()=>{m("/property"),s(!1)},X=()=>{ce(!0)},[ee,ce]=a.useState(!1);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-70 p-4 fade-in",children:e.jsxs("div",{className:"joyride-accountingproject joyride-startaccounting relative flex w-full flex-col items-center justify-center gap-3 rounded-lg bg-white p-8 md:w-[35%]",children:[o.isOpen&&e.jsx(Fe,{message:o.message,onConfirm:()=>{m("/accounting"),s(!1)},onCancel:()=>x({...o,isOpen:!1}),cancelMessage:o.cancelMessage,confirmMessage:o.confirmMessage}),e.jsx("h2",{className:"text-xl font-semibold",children:" 記帳面板"}),e.jsxs("div",{className:"flex gap-2 self-end",children:[e.jsx("div",{className:"joyride-class",children:e.jsx(gt,{newclassEditing:ee,setNewClassEditing:ce})}),e.jsx(F,{onClick:J,className:"mr-2",children:"取消"})]}),e.jsxs("div",{className:"flex w-full items-center gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold md:text-base",children:"日期"}),e.jsx("div",{className:"flex h-[30px] w-full items-center justify-center rounded-lg border border-black text-center focus:outline-none focus:ring-2 focus:ring-blue-500 md:h-[44px]",children:e.jsx(ot,{selected:Z,onChange:y=>H(y),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:5,timeCaption:"時間",dateFormat:"yyyy/MM/dd h:mm aa",className:"outline-none"})})]}),e.jsxs("form",{onSubmit:f(V),className:"flex w-full flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold md:text-base",children:"帳戶"}),e.jsxs("select",{className:"flex h-[30px] w-full items-center justify-center rounded-lg border border-black text-center md:h-[44px]",...d("account",{required:"請選擇帳戶"}),onChange:y=>{N("account",y.target.value),y.target.value==="addAccount"&&re()},children:[e.jsx("option",{value:"",children:"請選擇"}),Array.isArray(r)&&r.length>0?r.map(y=>e.jsx("option",{value:JSON.stringify({id:y.id,account:y.account}),children:y.account},y.id)):e.jsx(e.Fragment,{children:e.jsx("option",{value:"addAccount",disabled:!0,children:"您需要先新增帳戶"})})]})]}),h.account&&e.jsx("p",{className:"text-red-500",children:h.account.message})]}),e.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold text-[##BABFD1] md:text-base",children:"類型"}),e.jsxs("select",{className:"flex h-[30px] w-full items-center justify-center rounded-lg border border-black text-center md:h-[44px]",...d("type",{required:"請選擇類型"}),children:[e.jsx("option",{value:"",children:"請選擇"}),e.jsx("option",{children:"收入"}),e.jsx("option",{children:"支出"}),e.jsx("option",{children:"轉帳"})]})]}),h.type&&e.jsx("p",{className:"text-red-500",children:h.type.message})]}),j==="轉帳"?e.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold text-[##BABFD1] md:text-base",children:"轉入"}),e.jsxs("select",{className:"flex h-[30px] w-full items-center justify-center rounded-lg border border-black text-center md:h-[44px]",...d("targetaccount",{required:j==="轉帳"?"請選擇目標轉入帳戶":!1}),children:[e.jsx("option",{value:"",children:"請選擇"}),Array.isArray(b)&&b.map(y=>e.jsx("option",{value:JSON.stringify({id:y.id,account:y.account}),children:y.account},y.id))]})]}),h.targetaccount&&e.jsx("p",{className:"text-red-500",children:h.targetaccount.message})]}):e.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold text-[##BABFD1] md:text-base",children:"分類"}),e.jsxs("select",{className:"flex h-[30px] w-full items-center justify-center rounded-lg border border-black text-center md:h-[44px]",...d("class",{required:j!=="轉帳"?"請選擇分類":!1}),onChange:y=>{y.target.value==="addClass"&&X()},children:[e.jsx("option",{value:"",children:"請選擇"}),Array.isArray(A)&&A.length>0?A.map(y=>e.jsx("option",{value:y.name,children:y},y.id)):e.jsx("option",{value:"addClass",disabled:!0,children:"您需要先新增分類"})]})]}),h.class&&e.jsx("p",{className:"text-red-500",children:h.class.message})]}),Array.isArray(i)&&i.some(y=>y.isediting)&&e.jsxs("div",{className:"flex w-full items-center gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold text-[##BABFD1] md:text-base",children:"專案"}),e.jsxs("select",{className:"flex h-[30px] w-full items-center justify-center rounded-lg border border-black text-center md:h-[44px]",...d("project"),children:[e.jsx("option",{value:"",children:"請選擇"}),i.filter(y=>y.isediting).map(y=>e.jsx("option",{value:JSON.stringify({id:y.id,name:y.name}),children:y.name},y.id))]})]}),e.jsxs("div",{className:"flex w-full items-center gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold md:text-base",children:"幣別"}),e.jsx("div",{className:"grid w-full grid-cols-6 gap-1 md:h-[44px]",children:(n.length===0?[["TWD"]]:n).map(([y])=>e.jsxs("label",{className:`flex cursor-pointer items-center justify-center rounded-lg border p-1 ${M===y?"bg-[#545E75] text-white":"bg-gray-100"}`,children:[e.jsx("input",{type:"radio",name:"currency",value:y,checked:M===y,className:"hidden",...d("currency",{required:"請選擇幣別"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm font-semibold",children:y})})]},y))})]}),e.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex w-full gap-3",children:[e.jsx("div",{className:"text-nowrap text-sm font-semibold md:text-base",children:"金額"}),e.jsx("input",{className:"flex h-[30px] w-full items-center justify-center rounded-lg border border-black text-center md:h-[44px]",type:"number",placeholder:h.amount?h.amount.message:"金額不為 0",...d("amount",{required:"請輸入金額",valueAsNumber:!0,max:{value:1e11,message:"須小於一千億"},validate:y=>y>0||"金額必須大於 0"})})]}),h.amount&&e.jsx("p",{className:"text-red-500",children:h.amount.message})]}),M!=="TWD"&&O?e.jsxs("div",{className:"font-semibold text-red-400 fade-in",children:["等值 TWD$",E]}):e.jsx(e.Fragment,{}),e.jsx("div",{className:"flex w-full gap-2",children:e.jsx(F,{type:"submit",className:"flex-1",variant:"add",children:j==="轉帳"?"我要轉帳":"我要記一筆"})})]})]})})}function Ms(){const{accounting:s,setAccounting:r}=P(),[l,i]=a.useState(!navigator.onLine),[n,t]=a.useState(!1),c=()=>{r(!0)};return a.useEffect(()=>{const m=localStorage.getItem("isOffline");m&&(i(m==="true"),t(m==="true"));const o=()=>{t(!1),setTimeout(()=>{i(!1),localStorage.setItem("isOffline","false")},500)},x=()=>{i(!0),localStorage.setItem("isOffline","true"),setTimeout(()=>t(!0),10)};return window.addEventListener("online",o),window.addEventListener("offline",x),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",x)}},[]),e.jsxs(e.Fragment,{children:[e.jsx(Je,{linkToBackstage:!1}),e.jsxs("div",{className:"mt-[80px] flex min-h-[100vh] items-stretch justify-start",children:[e.jsx(Rs,{className:"h-auto"}),e.jsx(os,{})]}),e.jsx("div",{onClick:()=>c(),className:"joyride-accounting group fixed bottom-16 right-4 flex h-16 w-16 cursor-pointer items-center justify-center rounded-[50%] bg-white shadow-lg transition-all duration-300 hover:w-56 hover:rounded-full hover:opacity-100",children:e.jsxs("div",{className:"relative flex h-full w-full items-center justify-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-8 w-8 transition-opacity duration-200 group-hover:opacity-0",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("span",{className:"absolute left-20 w-0 overflow-hidden text-lg font-semibold opacity-0 transition-all duration-200 group-hover:w-auto group-hover:whitespace-nowrap group-hover:opacity-100 group-hover:delay-200",children:"我要記帳"})]})}),l&&e.jsxs("div",{className:`absolute bottom-10 left-10 z-50 flex w-[200px] flex-col items-start rounded-lg bg-white px-10 py-10 shadow-md transition-transform duration-500 md:w-[600px] ${n?"translate-x-0":"-translate-x-[120%]"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"red",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-1 size-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})}),e.jsx("p",{className:"mb-2 text-xl font-semibold",children:"您處於離線狀態。"})]}),e.jsx("p",{className:"text-xl",children:"您可以繼續使用記帳功能。"})]}),s&&e.jsx(pt,{setAccounting:r})]})}const jt=a.createContext(),Es=({children:s})=>{const[r,l]=a.useState(!0),[i,n]=a.useState(0),t=[{target:".joyride-account",content:"1、開始記帳前，您需先新增帳戶，帳戶類型可以根據用途新增在消費、投資或是儲蓄中。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-accounting",content:"2、點擊右下角圓框，進到記帳儀表板。",disableBeacon:!0},{target:".joyride-class",content:"3、新增分類後，即可開始您的記帳。",disableBeacon:!0},{target:".joyride-startaccounting",content:"4、記帳儀表板可以選擇各種分類及幣值。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-totalproperty",content:"5、您可以定期檢視自己的淨資產分佈狀況。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}}],[c,m]=a.useState(!0),[o,x]=a.useState(0),u=[{target:".joyride-datachange",content:"1、本區塊是支出變化表，讓您檢視當月每日的支出變化。（兩日交易紀錄後出現）",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-income",content:"2、本區塊是本月收入分佈，讓您掌握收入比例及來源。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-transaction",content:"3、本區塊紀錄每一筆交易數據，您可以點選每一筆紀錄進行編輯。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-expense",content:"4、本區塊是支出分佈圓餅圖，讓您掌握本月份的支出分佈及金額。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-balance",content:"5、本月收支餘額，隨時提醒您可支配的餘額。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-changemonth",content:"6、可透過上方按鈕切換月份，檢視不同月份數據。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-drag",content:"7、每個區塊的圖表可以點擊上方標題進行拖動，自定義儀表板排版。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}}],[D,d]=a.useState(!0),[f,p]=a.useState(0),N=[{target:".joyride-monthlydata",content:"1、本區塊會統計您上個月的收支數據，供您重新檢視。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-balancesheet",content:"2、本區塊將正資產及負債透過顏色區隔出來，您可以對資產狀況一目瞭然。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-generatereport",content:"3、每月過後您可以點選財務健檢，我們會為您進行全面的分析。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-report",content:"4、分析後的健檢報告將出現在歷史報告供您回顧。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}}],[C,h]=a.useState(!0),[j,R]=a.useState(0),T=[{target:".joyride-project",content:"1、理財專案區，您可以將新增旅遊計畫、結婚、儲蓄等等目的明確的專案，讓未來方便檢視。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-addproject",content:"2、點擊新增專案，即可填寫專案資訊。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-accountingproject",content:"3、新增專案後，即可在記帳面板看到選取專案的欄位。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}},{target:".joyride-report",content:"4、透過按鈕切換進行以及結束的專案。",disableBeacon:!0,styles:{tooltipContent:{textAlign:"left"}}}];return e.jsx(jt.Provider,{value:{run:r,setRun:l,steps:t,stepIndex:i,setStepIndex:n,dataRun:c,setDataRun:m,stepDataIndex:o,setStepDataIndex:x,dataSteps:u,analysisRun:D,setAnalysisRun:d,stepAnalysisIndex:f,setStepAnalysisIndex:p,analysisSteps:N,projectRun:C,setProjectRun:h,stepProjectIndex:j,setStepProjectIndex:R,projectSteps:T},children:s})},pe=()=>a.useContext(jt),Bs=()=>{const{dataRun:s,setDataRun:r,stepDataIndex:l,setStepDataIndex:i,dataSteps:n}=pe();a.useEffect(()=>{localStorage.getItem("hasSeenDataTutorial")?(r(!1),i(0)):r(!0)},[r,i]);const t=c=>{const{action:m,index:o,status:x,type:u,lifecycle:D}=c;if(x==="finished"||x==="skipped"||u==="close"||m==="close"&&D==="complete")r(!1),i(0),localStorage.setItem("hasSeenTutorial","true");else if(u==="step:after"&&(m==="next"||m==="prev")){const d=o+(m==="next"?1:-1);i(d)}};return e.jsx(Ee,{run:s,steps:n,stepIndex:l,continuous:!0,showSkipButton:!0,callback:t,disableBeacon:!0,disableScrolling:!0,spotlightClicks:!1,disableOverlayClose:!0,styles:{options:{zIndex:1e4,arrowColor:"#f2f2f2",backgroundColor:"#f2f2f2",textColor:"#333",overlayColor:"rgba(0, 0, 0, 0.5)",primaryColor:"#4a90e2",placement:"bottom"},spotlight:{borderRadius:"8px"},tooltip:{fontSize:"18px",fontWeight:"bold",backgroundColor:"#f2f2f2",borderRadius:"8px",color:"#333",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"},buttonNext:{backgroundColor:"#607196",color:"#fff",borderRadius:"8px"},buttonBack:{color:"#888",marginRight:"10px"},buttonSkip:{color:"#f03e3e"}}})};Be.register(..._e);function bt({firstDayOfSelectedMonth:s,lastDayOfSelectedMonth:r}){const{transactionData:l,setAccounting:i}=P(),[n,t]=a.useState([]),[c,m]=a.useState(0),[o,x]=a.useState(),[u,D]=a.useState();if(a.useEffect(()=>{(()=>{try{const N=l.filter(T=>{const M=T.time.toDate();return M>=s&&M<=r}),C=N.filter(T=>T.record_type==="收入").reduce((T,M)=>T+M.convertedAmountTWD,0);x(C);const h=N.filter(T=>T.record_type==="支出").reduce((T,M)=>T+M.convertedAmountTWD,0);D(h);const j=C-h;m(j),t([{label:"收入",value:C},{label:"支出",value:h}])}catch(N){console.error("查詢錯誤：",N)}})()},[l,s,r]),bt.propTypes={firstDayOfSelectedMonth:w.instanceOf(Date).isRequired,lastDayOfSelectedMonth:w.instanceOf(Date).isRequired},(o===0||o===void 0)&&(u===0||u===void 0))return e.jsxs("div",{className:"flex flex-1 items-center justify-center rounded-lg border bg-slate-500 p-6 text-white opacity-40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 mr-2 size-10",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("p",{onClick:()=>i(!0),className:"cursor-pointer",children:"前往記帳，即可觀看本月盈餘"})]});const d={labels:n.map(p=>p.label),datasets:[{data:n.map(p=>p.value),backgroundColor:["#9DBEBB","#d6d6d6"],hoverBackgroundColor:["#9DBEBB","#eeeeee"],borderWidth:0}]},f={layout:{padding:{right:75,left:75}},maintainAspectRatio:!0,responsive:!0,devicePixelRatio:window.devicePixelRatio,cutout:"60%",plugins:{tooltip:{callbacks:{label:p=>{const N=p.chart.data.datasets[0].data.reduce((j,R)=>j+R,0),C=(p.raw/N*100).toFixed(1),h=p.raw;return`${p.label}: $${h.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})} (${C}%)`}},backgroundColor:"rgba(0, 0, 0, 0.7)",titleColor:"#fff",bodyColor:"#fff",titleFont:{size:18},bodyFont:{size:16}},legend:{display:!1},datalabels:{anchor:"end",align:"end",offset:10,font:{color:"#333",size:16,weight:"bold"},formatter:(p,N)=>p===0?"":`${N.chart.data.labels[N.dataIndex]}
$${p.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}`}}};return e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg p-4",children:e.jsxs("div",{className:"relative flex w-[300px] items-center justify-center lg:w-[400px]",children:[e.jsx(ct,{data:d,options:f}),e.jsx("div",{className:"absolute left-1/2 top-1/2 flex -translate-x-1/2 -translate-y-1/2 transform items-center justify-center text-center",children:e.jsxs("div",{className:"text-xl font-semibold",children:["月結餘 ",e.jsx("br",{}),"$",c.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})})]})})}function vt({firstDayOfSelectedMonth:s,lastDayOfSelectedMonth:r}){const{transactionData:l,setAccounting:i}=P(),[n,t]=a.useState([]);if(a.useEffect(()=>{(()=>{try{const u=l.filter(d=>{const f=d.record_type==="支出",p=d.time.toDate(),N=p>=s&&p<=r;return f&&N}).reduce((d,f)=>{const p=f.time.toDate().toLocaleDateString("zh-TW");return d[p]||(d[p]=0),d[p]+=f.convertedAmountTWD,d},{}),D=Object.entries(u).map(([d,f])=>({x:new Date(d).toLocaleDateString("zh-TW",{month:"numeric",day:"numeric"}),y:f})).sort((d,f)=>new Date(d.x)-new Date(f.x));t(D)}catch(x){console.error("查詢錯誤：",x)}})()},[l,s,r]),vt.propTypes={firstDayOfSelectedMonth:w.instanceOf(Date).isRequired,lastDayOfSelectedMonth:w.instanceOf(Date).isRequired},n.length<=1)return e.jsxs("div",{className:"flex w-full flex-1 items-center justify-center rounded-lg border bg-slate-500 p-6 text-white opacity-40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 mr-2 size-10",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("p",{onClick:()=>i(!0),className:"cursor-pointer",children:"前往記帳，即可觀看支出變化圖表"})]});const c={labels:n.map(o=>o.x),datasets:[{label:"每日支出 (NT$)",data:n.map(o=>o.y),fill:!1,borderColor:"#babfd1",borderWidth:3,backgroundColor:"#304D6D",pointRadius:5,tension:.1}]},m={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(o){return`NT$ ${o.parsed.y}`}},titleFont:{size:18},bodyFont:{size:16}},legend:{display:!1},datalabels:{display:!0,color:"black",backgroundColor:"#e8e9ed",borderRadius:4,padding:6,font:{size:16,weight:"bold"},anchor:"end",align:"left",offset:10,collisionDetection:"dataset",formatter:o=>` NT$ ${o.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}`},zoom:{pan:{enabled:!0,mode:"x"},zoom:{enabled:!0,mode:"x",speed:.1}}},scales:{x:{title:{display:!0,text:"日期"},ticks:{autoSkip:!0,maxTicksLimit:10,font:{size:16}},grid:{drawBorder:!1,offset:!0}},y:{title:{display:!0,text:"支出 (NT$)",padding:{top:-20}},beginAtZero:!0,ticks:{font:{size:16}}}},layout:{padding:{right:10,left:60,top:40}}};return e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg p-4",children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"h-[400px]",style:{width:`${n.length*100}px`},children:e.jsx(dt,{data:c,options:m,plugins:[$e,mt]})})})})}function ze({item:s,onEditClick:r,showTime:l=!0,showProject:i=!0}){return e.jsxs("div",{className:`rounded-lg border p-3 transition-all duration-200 ${s.record_type==="支出"?"bg-[#9dbebb] text-gray-800":s.record_type==="轉帳"?"bg-[#BABFD1] text-gray-800":"bg-[#e8e9ed] text-gray-800"}`,onClick:()=>r(s),children:[l&&e.jsx("div",{children:s.time.toDate().toLocaleDateString()}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-xl",children:s.record_type}),e.jsxs("div",{className:"text-xl",children:[s.record_type==="支出"?"-":"",s.currency,"$",s.amount.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsxs("div",{className:`flex justify-between ${s.record_type==="支出","text-gray-800"}`,children:[e.jsx("div",{className:"text-sm",children:s.class?s.class:`轉入 ${s.targetaccount}`}),e.jsx("div",{className:"text-sm",children:s.account})]}),i&&s.projectname&&e.jsx("div",{className:`${s.record_type==="支出","text-gray-800"}`,children:e.jsx("p",{children:s.projectname})})]},s.id)}ze.propTypes={item:w.shape({id:w.string.isRequired,record_type:w.oneOf(["支出","收入","轉帳"]).isRequired,time:w.object.isRequired,currency:w.string.isRequired,amount:w.number.isRequired,class:w.string,targetaccount:w.string,account:w.string.isRequired,projectname:w.string}).isRequired,onEditClick:w.func.isRequired,showTime:w.bool,showProject:w.bool};function wt({firstDayOfSelectedMonth:s,lastDayOfSelectedMonth:r}){const[l,i]=a.useState([]),{property:n,classData:t,projectData:c,setAccounting:m}=P(),[o,x]=a.useState(),{loginEmail:u}=P(),[D,d]=a.useState(null),{propertyCollectionRef:f}=ne(u);a.useEffect(()=>{const v=ut(u,i);return()=>v()},[u]);const N=(v=>v.filter(S=>{const B=S.time.toDate();return B>=s&&B<=r}).sort((S,B)=>B.time.toDate()-S.time.toDate()).reduce((S,B)=>{const W=B.time.toDate().toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",weekday:"short"});return S[W]||(S[W]=[]),S[W].push(B),S},{}))(l),[C,h]=a.useState(!1),[j,R]=a.useState(null),{register:T,handleSubmit:M,reset:O,setValue:A,watch:b,formState:{errors:k}}=Ae({defaultValues:{record_type:"",class:"",account:"",amount:0,targetaccount:""}}),E=v=>{R(v),h(!0),A("record_type",v.record_type),A("class",v.class),A("account",JSON.stringify({id:v.accountid||"",account:v.account})),A("amount",v.amount),A("project",JSON.stringify({id:v.projectid||"",name:v.projectname||""})),A("targetaccount",JSON.stringify({id:v.targetaccountid||"",account:v.targetaccount||""}));const g=v.time.toDate();x(g)},I=()=>{h(!1),R(null),O()},V=b("record_type"),Z=b("account"),H=Z?JSON.parse(Z):null,J=b("targetaccount"),re=V==="收入"?t.income:V==="支出"?t.expense:[],X=n.filter(v=>{const g=Z?JSON.parse(Z):null;return g?v.id!==g.id:!0});a.useEffect(()=>{C&&V!==(j==null?void 0:j.record_type)&&A("class","")},[V,A,C,j==null?void 0:j.record_type]),a.useEffect(()=>{C&&H.id!==(j==null?void 0:j.accountid)&&A("targetaccount","")},[Z,A,C,j==null?void 0:j.account]);const{rates:ee}=P(),ce=async v=>{try{const g=ie(de,"record",u,"accounting",j.id),L=v.account?JSON.parse(v.account):null,S=J?JSON.parse(J):null,B=v.project?JSON.parse(v.project):null,q=j.accountid,W=L.id,G=B.id||null,z=Number(j.amount),$=Number(v.amount),U=j.targetaccountid||"",te=S?S.id:null,ue=j.record_type==="收入",je=j.record_type==="支出",Ue=j.record_type==="轉帳",Ce=v.record_type==="收入",ke=v.record_type==="支出",Ye=v.record_type==="轉帳",Pe=j.currency,zt=o.getTime()===j.time.toDate().getTime();if(q===W&&z===$&&U===te&&j.record_type===v.record_type&&j.class===v.class&&zt&&j.projectid===G){d("沒有變更，不需儲存");return}const Ot=oe(f,_("id","==",q)),Pt=oe(f,_("id","==",W)),Qe=U?oe(f,_("id","==",U)):null,Ke=te?oe(f,_("id","==",te)):null,We=await ae(Ot),Ie=await ae(Pt),qe=Qe?await ae(Qe):null,He=Ke?await ae(Ke):null,Te=async(se,be)=>{const Vt=(se.data().balance||0)+be;await xe(se.ref,{balance:Vt})};let Y=0,Q=0,fe=0,le=0;Ue&&Ye?q===W&&U===te?(Q=z-$,le=$-z):q===te&&U===W?(Q=-(z+$),le=z+$):q!==W&&U===te?(Y=z,Q=-$):U!==te&&q===W?(fe=-z,le=$):q!==te&&U!==W&&(Y=z,fe=-z,Q=-$,le=$):(ue||je)&&Ye?ue?q===W?(Y=-(z+$),le=$):q===te?(Q=-$,le=$-z):(Y=-z,Q=-$,le=$):je&&(q===W?(Y=z-$,le=$):q===te?(Q=-$,le=z+$):(Y=z,Q=-$,le=$)):Ue&&(Ce||ke)?Ce?q===W?(fe=-z,Q=$+z):(fe=-z,Y=z,Q=$):ke&&(q===W?(fe=-z,Q=z-$):(fe=-z,Y=z,Q=-$)):q===W?ue&&Ce?Y=$-z:je&&ke?Y=z-$:ue&&ke?Y=-z-$:je&&Ce&&(Y=z+$):(Y=ue?-z:je?z:0,Q=Ce?$:ke?-$:0);let Xe=v.amount;if(Pe!=="TWD")if(ee[Pe]&&ee.TWD){const se=1/ee[Pe],be=ee.TWD;Xe=v.amount*se*be,Y=Y*se*be,Q=Q*se*be,fe=fe*se*be,le=le*se*be}else{alert("匯率資料不可用，無法轉換成 TWD");return}d("編輯成功"),I(),He&&!He.empty&&He.forEach(async se=>{le!==0&&await Te(se,le)}),We&&!We.empty&&We.forEach(async se=>{Y!==0&&await Te(se,Y)}),Ie&&!Ie.empty&&Ie.forEach(async se=>{Q!==0&&await Te(se,Q)}),qe&&!qe.empty&&qe.forEach(async se=>{fe!==0&&await Te(se,fe)});const Wt=S?S.account:null,It=S?S.id:null,{project:cr,...qt}=v,Ht={...qt,class:v.class||null,account:L.account,accountid:W,targetaccount:Wt,targetaccountid:It,projectid:B.id||null,projectname:B.name||null,time:o||j.time,convertedAmountTWD:Xe};await Me(g,Ht,{merge:!0})}catch(g){console.error("Error updating document:",g)}},y=async()=>{try{const v=ie(de,"record",u,"accounting",j.id),g=oe(f,_("id","==",j.accountid));if(j.targetaccount){const G=oe(f,_("id","==",j.targetaccountid)),z=await ae(G),$=Number(j.convertedAmountTWD);z.empty||z.forEach(async U=>{const ue=(U.data().balance||0)-$;await xe(U.ref,{balance:ue})})}const L=await ae(g),S=Number(j.convertedAmountTWD),B=j.record_type==="收入",q=j.record_type==="支出",W=j.record_type==="轉帳";L.empty||L.forEach(async G=>{const z=G.data().balance||0;let $;W?$=z+S:$=B?z-S:q?z+S:z,d("刪除成功"),h(!1),await xe(G.ref,{balance:$})}),await ge(v)}catch(v){console.error("Error updating document:",v)}};return wt.propTypes={firstDayOfSelectedMonth:w.instanceOf(Date).isRequired,lastDayOfSelectedMonth:w.instanceOf(Date).isRequired},Object.keys(N).length===0?e.jsxs("div",{className:"flex h-full w-full items-center justify-center rounded-lg border bg-slate-500 p-6 text-white opacity-40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 mr-2 size-10",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("p",{onClick:()=>m(!0),className:"cursor-pointer",children:"前往記帳，即可觀看每日紀錄"})]}):e.jsxs("div",{className:"flex flex-1 flex-col overflow-scroll rounded-lg p-4",children:[D&&e.jsx(he,{message:D,onClose:()=>d(null)}),e.jsxs("div",{children:[Object.entries(N).map(([v,g])=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsx("div",{className:"text-nowrap text-lg font-semibold text-gray-800",children:v}),e.jsx("div",{className:"mx-auto w-full border-[0.5px] border-gray-400"}),e.jsxs("div",{className:"text-lg font-bold text-gray-800",children:["NT$",g.reduce((L,S)=>{if(S.record_type==="轉帳")return L;const B=S.record_type==="支出"?-Number(S.convertedAmountTWD):Number(S.convertedAmountTWD);return L+B},0).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:g.map(L=>e.jsx(ze,{item:L,onEditClick:E,showTime:!1},L.id))})]},v)),C&&e.jsx("div",{className:"fixed inset-0 z-10 flex items-center justify-center bg-gray-800 bg-opacity-75 fade-in",children:e.jsxs("div",{className:"w-[90%] max-w-lg rounded-lg bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"編輯帳單"}),e.jsxs("div",{children:[e.jsx(F,{type:"button",variant:"delete",onClick:y,className:"mr-2",children:"刪除此筆"}),e.jsx(F,{type:"button",onClick:I,children:"取消"})]})]}),e.jsxs("form",{onSubmit:M(ce),children:[e.jsxs("div",{className:"mb-3 flex w-full items-center gap-2",children:[e.jsx("label",{className:"text-nowrap text-gray-700",children:"日期"}),e.jsx("div",{className:"w-full rounded-lg border p-1 text-xs md:p-2 md:text-base",children:e.jsx(ot,{selected:o,onChange:v=>x(v),showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:5,timeCaption:"時間",dateFormat:"yyyy/MM/dd h:mm aa",className:"focus:outline-none focus:ring-2 focus:ring-blue-500"})})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("label",{className:"text-nowrap text-gray-700",children:"帳戶"}),e.jsx("select",{className:"w-full rounded-lg border p-2",...T("account",{required:"請選擇帳戶"}),children:Array.isArray(n)&&n.map(v=>e.jsx("option",{value:JSON.stringify({id:v.id,account:v.account}),children:v.account},v.id))})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("label",{className:"text-nowrap text-gray-700",children:"類別"}),e.jsxs("select",{className:"w-full rounded-lg border p-2",...T("record_type",{required:"請選擇類別"}),children:[e.jsx("option",{value:"收入",children:"收入"}),e.jsx("option",{value:"支出",children:"支出"}),e.jsx("option",{value:"轉帳",children:"轉帳"})]})]}),V==="轉帳"?e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("label",{className:"text-nowrap text-gray-700",children:"轉入"}),e.jsx("select",{className:"w-full rounded-lg border p-2",...T("targetaccount",{required:V==="轉帳"?"請選擇轉入帳戶":!1}),children:Array.isArray(X)&&X.map((v,g)=>e.jsx("option",{value:JSON.stringify({id:v.id,account:v.account}),children:v.account},g))})]}):e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("label",{className:"text-nowrap text-gray-700",children:"分類"}),e.jsx("select",{className:"w-full rounded-lg border p-2",...T("class",{required:V!=="轉帳"?"請選擇子分類":!1}),children:Array.isArray(re)&&re.map((v,g)=>e.jsx("option",{children:v},g))})]}),Array.isArray(c)&&c.some(v=>v.isediting)&&e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("label",{className:"text-nowrap text-gray-700",children:"專案"}),e.jsx("select",{className:"w-full rounded-lg border p-2",...T("project"),children:c.filter(v=>v.isediting===!0).map(v=>e.jsx("option",{value:JSON.stringify({id:v.id,name:v.name}),children:v.name},v.id))})]}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"text-nowrap text-gray-700",children:"幣別"}),e.jsx("div",{className:"flex w-full cursor-pointer items-center justify-center rounded-lg border p-1",children:j.currency})]}),e.jsxs("div",{className:"mb-3 flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx("label",{className:"text-nowrap text-gray-700",children:"金額"}),e.jsx("input",{className:"w-full rounded-lg border p-2",type:"number",...T("amount",{required:"請輸入金額",valueAsNumber:!0,max:{value:1e11,message:"須小於一千億"},validate:v=>v>0||"金額必須大於 0"})})]}),k.amount&&e.jsx("p",{className:"text-red-500",children:k.amount.message})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(F,{type:"submit",variant:"add",children:"保存"})})]})]})})]})]})}Be.register(..._e,$e);function yt({firstDayOfSelectedMonth:s,lastDayOfSelectedMonth:r}){const{transactionData:l,setAccounting:i}=P(),[n,t]=a.useState([]);if(a.useEffect(()=>{(()=>{try{const u=l.filter(d=>{const f=d.record_type==="支出",p=d.time.toDate(),N=p>=s&&p<=r;return f&&N}).reduce((d,f)=>{const{class:p,convertedAmountTWD:N}=f;return d[p]||(d[p]=0),d[p]+=N,d},{}),D=Object.entries(u).map(([d,f])=>({label:d,value:f}));t(D)}catch(x){console.error("查詢錯誤：",x)}})()},[l,s,r]),yt.propTypes={firstDayOfSelectedMonth:w.instanceOf(Date).isRequired,lastDayOfSelectedMonth:w.instanceOf(Date).isRequired},n.length===0)return e.jsxs("div",{className:"flex flex-1 items-center justify-center rounded-lg bg-slate-500 p-6 text-white opacity-40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 mr-2 size-10",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("p",{onClick:()=>i(!0),className:"cursor-pointer",children:"開始記帳，即可觀看支出圖表"})]});const c={labels:n.map(o=>o.label),datasets:[{data:n.map(o=>o.value),backgroundColor:["#d6d6d6","#9dbebb","#e8e9ed","#babfd1","#A7CCED"],borderWidth:0}]},m={layout:{padding:{right:75,left:75}},maintainAspectRatio:!0,responsive:!0,devicePixelRatio:window.devicePixelRatio,plugins:{tooltip:{callbacks:{title:o=>o[0].label,label:o=>{const x=o.raw,u=o.chart.data.datasets[0].data.reduce((d,f)=>d+f,0),D=(x/u*100).toFixed(1);return`金額: $${x.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})} (${D}%)`}},backgroundColor:"rgba(0, 0, 0, 0.7)",titleFont:{size:18},bodyFont:{size:16},titleColor:"#fff",bodyColor:"#fff"},datalabels:{anchor:"end",align:"end",font:{color:"#333",size:16,weight:"bold"},offset:10,formatter:(o,x)=>{const u=x.chart.data.datasets[0].data.reduce((d,f)=>d+f,0);return o/u*100<5?"":`${x.chart.data.labels[x.dataIndex]}
$${o.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}`}},legend:{display:!1}}};return e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg p-4",children:e.jsx("div",{className:"flex w-[300px] justify-center lg:w-[400px]",children:e.jsx(xt,{data:c,options:m})})})}Be.register(..._e,$e);function Nt({firstDayOfSelectedMonth:s,lastDayOfSelectedMonth:r}){const{transactionData:l,setAccounting:i}=P(),[n,t]=a.useState([]);if(a.useEffect(()=>{(()=>{try{const u=l.filter(d=>{const f=d.record_type==="收入",p=d.time.toDate(),N=p>=s&&p<=r;return f&&N}).reduce((d,f)=>{const{class:p,convertedAmountTWD:N}=f;return d[p]||(d[p]=0),d[p]+=N,d},{}),D=Object.entries(u).map(([d,f])=>({label:d,value:f}));t(D)}catch(x){console.error("查詢錯誤：",x)}})()},[l,s,r]),Nt.propTypes={firstDayOfSelectedMonth:w.instanceOf(Date).isRequired,lastDayOfSelectedMonth:w.instanceOf(Date).isRequired},n.length===0)return e.jsxs("div",{className:"flex flex-1 items-center justify-center rounded-lg border bg-slate-500 p-6 text-white opacity-40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 mr-2 size-10",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("p",{onClick:()=>i(!0),className:"cursor-pointer",children:"開始記帳，即可觀看收入圖表"})]});const c={labels:n.map(o=>o.label),datasets:[{data:n.map(o=>o.value),backgroundColor:["#9dbebb","#e8e9ed","#babfd1","#d6d6d6","#A7CCED"],borderWidth:0}]},m={layout:{padding:{right:75,left:75}},maintainAspectRatio:!0,responsive:!0,devicePixelRatio:window.devicePixelRatio,plugins:{tooltip:{callbacks:{title:o=>o[0].label,label:o=>{const x=o.raw,u=o.chart.data.datasets[0].data.reduce((d,f)=>d+f,0),D=(x/u*100).toFixed(1);return`金額: $${x} (${D}%)`}},backgroundColor:"rgba(0, 0, 0, 0.7)",titleFont:{size:18},bodyFont:{size:16},titleColor:"#fff",bodyColor:"#fff"},datalabels:{anchor:"end",align:"end",font:{color:"#333",size:16,weight:"bold"},offset:10,formatter:(o,x)=>{const u=x.chart.data.datasets[0].data.reduce((d,f)=>d+f,0);return o/u*100<5?"":`${x.chart.data.labels[x.dataIndex]}
$${o.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}`}},legend:{display:!1}}};return e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg p-4",children:e.jsx("div",{className:"flex w-[300px] justify-center lg:w-[400px]",children:e.jsx(xt,{data:c,options:m})})})}const $s=et.WidthProvider(et.Responsive);function Fs(){const[s,r]=a.useState(!0),{transactionData:l}=P(),[i,n]=a.useState(!0);a.useEffect(()=>{if(Array.isArray(l)&&l.length===0&&i){const C=setTimeout(()=>{r(!1),n(!1)},2500);return()=>clearTimeout(C)}else Array.isArray(l)&&l.length>0&&(r(!1),n(!1))},[l]);const{setDataRun:t}=pe();a.useEffect(()=>{s||localStorage.getItem("hasSeenDataTutorial")||(t(!0),localStorage.setItem("hasSeenDataTutorial","true"))},[t,s]);const c={lg:[{i:"b",x:0,y:0,w:4,h:50,minH:50,minW:4},{i:"c",x:8,y:0,w:4,h:50,minH:50,minW:4},{i:"d",x:0,y:1,w:4,h:50,minH:50,minW:4},{i:"e",x:4,y:1,w:4,h:50,minH:50,minW:4},{i:"f",x:8,y:1,w:4,h:50,minH:50,minW:4}],md:[{i:"b",x:0,y:1,w:5,h:60,minH:60,minW:4},{i:"c",x:0,y:1,w:5,h:60,minH:60,minW:4},{i:"d",x:0,y:2,w:5,h:50,minH:50,minW:4},{i:"e",x:5,y:2,w:5,h:50,minH:50,minW:4},{i:"f",x:0,y:3,w:5,h:50,minH:50,minW:4}],sm:[{i:"b",x:0,y:1,w:6,h:50,minH:50,minW:6},{i:"c",x:0,y:2,w:6,h:80,minH:80,minW:6},{i:"d",x:0,y:4,w:6,h:40,minH:40,minW:6},{i:"e",x:0,y:5,w:6,h:40,minH:40,minW:6},{i:"f",x:0,y:6,w:6,h:40,minH:40,minW:6}]},[m,o]=a.useState(()=>{const C=localStorage.getItem("accountingLayouts");return C?JSON.parse(C):c}),x=(C,h)=>{localStorage.setItem("accountingLayouts",JSON.stringify(h)),o(h)},[u,D]=a.useState(new Date),d=C=>{D(h=>{const j=new Date(h);if(C==="next")j.setMonth(j.getMonth()+1);else if(C==="prev")j.setMonth(j.getMonth()-1);else return new Date;return j})},f=new Date(u.getFullYear(),u.getMonth(),1),p=new Date(u.getFullYear(),u.getMonth()+1,0,23,59,59),N=()=>{t(!0)};return s&&i?e.jsx("div",{className:"w-full pt-5",children:e.jsxs("div",{className:"mx-auto mb-[10vh] flex w-[85%] flex-col pl-11 md:pl-0",children:[e.jsx(K,{height:72,width:"100%"}),e.jsxs("div",{className:"mt-2 flex w-full flex-col gap-2 md:flex-row",children:[e.jsx("div",{className:"h-[540px] flex-grow",children:e.jsx(K,{height:"100%",width:"100%"})}),e.jsx("div",{className:"h-[540px] flex-grow",children:e.jsx(K,{height:"100%",width:"100%"})}),e.jsx("div",{className:"h-[540px] flex-grow",children:e.jsx(K,{height:"100%",width:"100%"})})]}),e.jsxs("div",{className:"mt-2 flex w-full flex-col gap-2 md:flex-row",children:[e.jsx("div",{className:"h-[540px] flex-grow",children:e.jsx(K,{height:"100%",width:"100%"})}),e.jsx("div",{className:"h-[540px] flex-grow",children:e.jsx(K,{height:"100%",width:"100%"})}),e.jsx("div",{className:"h-[540px] flex-grow"})]})]})}):e.jsxs("div",{className:"flex w-full flex-col items-center justify-center bg-gradient-to-r from-[#e3e3e3] via-[#efefef] to-[#e3e3e3] pb-[10vh] pl-11 fade-in md:pl-0",children:[e.jsx(Bs,{}),e.jsx("div",{className:"mt-5 w-[85%] px-3",children:e.jsxs("div",{className:"joyride-changemonth flex items-center justify-between rounded-lg bg-[#fcfcfc] p-1 shadow-lg md:p-4",children:[e.jsx("div",{className:"flex md:w-[228px]",children:e.jsxs(F,{variant:"retain",className:"flex items-center justify-center gap-1 md:gap-2",onClick:()=>d("prev"),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m18.75 4.5-7.5 7.5 7.5 7.5m-6-15L5.25 12l7.5 7.5"})}),e.jsx("p",{className:"hidden text-sm md:block md:text-base",children:"上個月"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg p-1 md:p-2",children:e.jsx("div",{className:"flex h-full items-center text-sm font-semibold md:text-xl",children:`${u.getFullYear()}年 ${u.getMonth()+1}月`})}),e.jsxs(F,{variant:"retain",className:"flex items-center justify-center gap-1 md:gap-2",onClick:()=>d(""),children:[e.jsx("p",{className:"hidden text-sm md:block md:text-nowrap md:text-base",children:"回本月"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"block size-4 md:hidden",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"})})]})]}),e.jsxs("div",{className:"flex gap-1 md:gap-2",children:[e.jsxs(F,{className:"flex items-center justify-center gap-1 md:gap-2",onClick:()=>N(),variant:"grey",children:[e.jsx("p",{className:"hidden text-sm md:block md:text-base",children:"使用教學"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"yellow",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})})]}),e.jsxs(F,{variant:"retain",className:"flex items-center justify-center gap-1 md:gap-2",onClick:()=>d("next"),children:[e.jsx("p",{className:"hidden text-sm md:block md:text-base",children:"下個月"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m5.25 4.5 7.5 7.5-7.5 7.5m6-15 7.5 7.5-7.5 7.5"})})]})]})]})}),e.jsx("div",{style:{width:"85%",margin:"0 auto",borderRadius:"8px"},children:e.jsxs($s,{className:"layout",layouts:m,breakpoints:{lg:1200,md:996,sm:768},cols:{lg:12,md:10,sm:6},rowHeight:1,draggableHandle:".drag-handle",onLayoutChange:(C,h)=>x(C,h),children:[e.jsxs("div",{className:"joyride-datachange flex flex-col rounded-lg bg-[#fcfcfc] shadow-lg",children:[e.jsx("div",{className:"joyride-drag drag-handle cursor-move rounded-lg p-4 text-center text-xl font-semibold",children:"本月支出變化表"}),e.jsx(vt,{firstDayOfSelectedMonth:f,lastDayOfSelectedMonth:p})]},"b"),e.jsxs("div",{className:"joyride-transaction flex flex-col rounded-lg bg-[#fcfcfc] shadow-lg",children:[e.jsx("div",{className:"drag-handle cursor-move rounded-lg p-4 text-center text-xl font-semibold",children:"交易紀錄"}),e.jsx(wt,{firstDayOfSelectedMonth:f,lastDayOfSelectedMonth:p})]},"c"),e.jsxs("div",{className:"joyride-expense flex flex-col rounded-lg bg-[#fcfcfc] shadow-lg",children:[e.jsx("div",{className:"drag-handle cursor-move rounded-lg p-4 text-center text-xl font-semibold",children:"本月支出分佈"}),e.jsx(yt,{firstDayOfSelectedMonth:f,lastDayOfSelectedMonth:p})]},"d"),e.jsxs("div",{className:"joyride-income flex flex-col rounded-lg bg-[#fcfcfc] shadow-lg",children:[e.jsx("div",{className:"drag-handle cursor-move rounded-lg p-4 text-center text-xl font-semibold",children:"本月收入分佈"}),e.jsx(Nt,{firstDayOfSelectedMonth:f,lastDayOfSelectedMonth:p})]},"e"),e.jsxs("div",{className:"joyride-balance flex flex-col rounded-lg bg-[#fcfcfc] shadow-lg",children:[e.jsx("div",{className:"drag-handle cursor-move rounded-lg p-4 text-center text-xl font-semibold",children:"本月盈餘"}),e.jsx(bt,{firstDayOfSelectedMonth:f,lastDayOfSelectedMonth:p})]},"f")]})})]})}const zs=()=>{const{analysisRun:s,setAnalysisRun:r,stepAnalysisIndex:l,setStepAnalysisIndex:i,analysisSteps:n}=pe();a.useEffect(()=>{localStorage.getItem("hasSeenTutorial")?(r(!1),i(0)):r(!0)},[r,i]);const t=c=>{const{action:m,index:o,status:x,type:u,lifecycle:D}=c;if(x==="finished"||x==="skipped"||u==="close"||m==="close"&&D==="complete")r(!1),i(0),localStorage.setItem("hasSeenTutorial","true");else if(u==="step:after"&&(m==="next"||m==="prev")){const d=o+(m==="next"?1:-1);i(d)}};return e.jsx(Ee,{run:s,steps:n,stepIndex:l,continuous:!0,showSkipButton:!0,callback:t,disableBeacon:!0,disableScrolling:!0,spotlightClicks:!1,disableOverlayClose:!0,styles:{options:{zIndex:1e4,arrowColor:"#f2f2f2",backgroundColor:"#f2f2f2",textColor:"#333",overlayColor:"rgba(0, 0, 0, 0.5)",primaryColor:"#4a90e2",placement:"bottom"},spotlight:{borderRadius:"8px"},tooltip:{fontSize:"18px",fontWeight:"bold",backgroundColor:"#f2f2f2",borderRadius:"8px",color:"#333",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"},buttonNext:{backgroundColor:"#607196",color:"#fff",borderRadius:"8px"},buttonBack:{color:"#888",marginRight:"10px"},buttonSkip:{color:"#f03e3e"}}})};function Os(){const{property:s}=P(),[r,l]=a.useState(0),i=s.filter(t=>t.balance>0),n=s.filter(t=>t.balance<0);return a.useEffect(()=>{const t=s.reduce((c,m)=>c+m.balance,0);l(t)},[l,s]),s.length===0?e.jsxs("div",{className:"flex w-full items-center justify-center rounded-lg border bg-slate-500 p-6 text-white opacity-40 md:h-[595px]",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 h-12 w-12",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})}),e.jsx("p",{className:"ml-2",children:"無資產或負債"})]}):e.jsx("div",{className:"flex max-h-[100vh] w-full flex-col items-center overflow-scroll rounded-lg",children:e.jsxs("div",{className:"flex h-[700px] w-full flex-col gap-2 overflow-scroll bg-[#fcfcfc] px-4 pb-7 shadow-lg",children:[e.jsx("h2",{className:"sticky top-0 mb-2 w-full rounded-lg bg-[#fcfcfc] pb-2 pt-7 text-center text-xl font-semibold",children:"資產負債表"}),e.jsx("div",{className:"flex flex-col items-center gap-2 rounded-lg px-4",children:i.map(t=>e.jsxs("div",{className:"flex h-20 w-full items-center justify-between rounded-lg border bg-[#e8e9ed] p-4 text-gray-800",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z"})}),e.jsx("div",{className:"text-xs font-semibold sm:text-sm lg:text-lg",children:t.account})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"self-end text-xs font-semibold sm:text-sm lg:text-xl",children:["NT$",t.balance.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsxs("div",{className:"lg:text-md self-end text-sm sm:text-base",children:[t.account_type,"帳"]})]})]},t.account))}),e.jsx("div",{className:"flex flex-col items-center gap-2 rounded-lg px-4",children:n.map(t=>e.jsxs("div",{className:"flex h-20 w-full items-center justify-between rounded-lg border bg-[#aaaaaa] p-4 text-white",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})}),e.jsx("div",{className:"text-xs font-semibold sm:text-sm lg:text-lg",children:t.account})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"self-end text-xs font-semibold sm:text-sm lg:text-xl",children:["NT$",t.balance.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsxs("div",{className:"lg:text-md self-end text-sm sm:text-base",children:[t.account_type,"帳"]})]})]},t.account))}),e.jsx("div",{className:"flex flex-col items-center gap-2 rounded-lg px-4",children:e.jsxs("div",{className:"flex h-20 w-full items-center justify-between rounded-lg border bg-[#babfd1] p-4 text-gray-800",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"})}),e.jsx("div",{className:"text-xs font-semibold sm:text-sm lg:text-lg",children:"淨資產"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"self-end text-xs font-semibold sm:text-sm lg:text-xl",children:["NT$",r.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"lg:text-md self-end text-sm sm:text-base"})]})]})})]})})}function Ct({setmonthExpense:s,setmonthIncome:r,expenseTotals:l,setExpenseTotals:i,incomeTotals:n,setIncomeTotals:t,netWorth:c,setNetWorth:m,setExpenseRecords:o}){const{loginEmail:x}=P(),{accountingCollectionRef:u}=ne(x);a.useEffect(()=>{(async()=>{try{const b=new Date,k=new Date(b.getFullYear(),b.getMonth()-1,1),E=new Date(b.getFullYear(),b.getMonth(),0,23,59,59),I=oe(u,_("record_type","==","支出"),_("time",">=",k),_("time","<=",E)),V=oe(u,_("record_type","==","收入"),_("time",">=",k),_("time","<=",E)),H=(await ae(I)).docs.map(g=>({id:g.id,...g.data()}));o(H);const re=(await ae(V)).docs.map(g=>({id:g.id,...g.data()})),X=H.reduce((g,L)=>{const{class:S,convertedAmountTWD:B}=L;return g[S]||(g[S]=0),g[S]+=B,g},{}),ee=re.reduce((g,L)=>{const{class:S,convertedAmountTWD:B}=L;return g[S]||(g[S]=0),g[S]+=B,g},{});i(X),t(ee);const ce=Object.values(X).reduce((g,L)=>g+L,0);s(ce);const y=Object.values(ee).reduce((g,L)=>g+L,0);r(y);const v=y-ce;m(v)}catch(b){console.error("查詢錯誤：",b)}})()},[]);const[D,d]=a.useState({}),[f,p]=a.useState({}),[N,C]=a.useState(0);a.useEffect(()=>{(async()=>{try{const b=new Date,k=new Date(b.getFullYear(),b.getMonth()-2,1),E=new Date(b.getFullYear(),b.getMonth()-1,0,23,59,59),I=oe(u,_("record_type","==","支出"),_("time",">=",k),_("time","<=",E)),V=oe(u,_("record_type","==","收入"),_("time",">=",k),_("time","<=",E)),H=(await ae(I)).docs.map(g=>({id:g.id,...g.data()})),re=(await ae(V)).docs.map(g=>({id:g.id,...g.data()})),X=H.reduce((g,L)=>{const{class:S,convertedAmountTWD:B}=L;return g[S]||(g[S]=0),g[S]+=B,g},{});d(X);const ee=re.reduce((g,L)=>{const{class:S,convertedAmountTWD:B}=L;return g[S]||(g[S]=0),g[S]+=B,g},{});p(ee);const ce=Object.values(X).reduce((g,L)=>g+L,0),v=Object.values(ee).reduce((g,L)=>g+L,0)-ce;C(v)}catch(b){console.error("查詢錯誤：",b)}})()},[]);const h=(A,b)=>{const k=A-b,E=b!==0?(k/b*100).toFixed(2):"N/A";return{changeAmount:k,changePercentage:E}},j=Object.entries(l).map(([A,b])=>{const k=D[A]||0,{changeAmount:E,changePercentage:I}=h(b,k);return{recordClass:A,totalAmount:b,changeAmount:E,changePercentage:I}}),R=Object.entries(n).map(([A,b])=>{const k=f[A]||0,{changeAmount:E,changePercentage:I}=h(b,k);return{recordClass:A,totalAmount:b,changeAmount:E,changePercentage:I}}),{changeAmount:T,changePercentage:M}=h(c,N),O=new Date;return Ct.propTypes={setmonthExpense:w.func.isRequired,setmonthIncome:w.func.isRequired,expenseTotals:w.func.isRequired,setExpenseTotals:w.func.isRequired,incomeTotals:w.func.isRequired,setIncomeTotals:w.func.isRequired,netWorth:w.func.isRequired,setNetWorth:w.func.isRequired,setExpenseRecords:w.func.isRequired},Object.keys(l).length===0&&Object.keys(n).length===0?e.jsxs("div",{className:"flex h-full w-full items-center justify-center rounded-lg border bg-slate-500 p-6 text-white opacity-40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 h-12 w-12",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})}),e.jsx("p",{className:"ml-2",children:"無上月記帳數據"})]}):e.jsx("div",{className:"flex max-h-[100vh] w-full flex-col items-center overflow-scroll rounded-lg",children:e.jsxs("div",{className:"flex h-[700px] w-full flex-col gap-2 overflow-scroll bg-[#fcfcfc] px-4 pb-7 shadow-lg",children:[e.jsx("h2",{className:"sticky top-0 w-full rounded-lg bg-[#fcfcfc] pb-2 pt-7 text-center text-xl font-semibold",children:`${O.getFullYear()} 年 ${O.getMonth()} 月收支數據`}),e.jsx("div",{className:"flex flex-col items-center gap-2 rounded-lg px-4",children:j.map(({recordClass:A,totalAmount:b,changeAmount:k,changePercentage:E})=>e.jsxs("div",{className:"flex h-20 w-full items-center justify-between rounded-lg bg-[#9dbebb] px-4",children:[e.jsxs("div",{children:[k>=0?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#9DBEBB",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 4.306 6.43l.776 2.898m0 0 3.182-5.511m-3.182 5.51-5.511-3.181"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 sm:text-sm lg:text-lg",children:A})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("p",{className:"flex text-sm font-semibold sm:text-lg lg:text-xl",children:["NT$",b.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsxs("div",{className:`text-sm font-semibold ${k>=0,"text-gray-600"}`,children:[k>=0?"+":"",k.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"text-sm text-gray-600",children:E!=="N/A"?` ${E}%`:"0%"})]})]},A))}),e.jsx("div",{className:"flex flex-col items-center gap-2 rounded-lg px-4",children:R.map(({recordClass:A,totalAmount:b,changeAmount:k,changePercentage:E})=>e.jsxs("div",{className:"flex h-20 w-full items-center justify-between rounded-lg bg-[#e8e9ed] p-4",children:[e.jsxs("div",{children:[k>=0?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#9DBEBB",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 4.306 6.43l.776 2.898m0 0 3.182-5.511m-3.182 5.51-5.511-3.181"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 sm:text-sm lg:text-lg",children:A})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("p",{className:"flex text-sm font-semibold text-gray-800 sm:text-lg lg:text-xl",children:["NT$",b.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsxs("div",{className:`text-sm font-semibold ${k>=0,"text-gray-600"}`,children:[k>=0?"+":"",k.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"text-sm text-gray-600",children:E!=="N/A"?` ${E}%`:"0%"})]})]},A))}),e.jsx("div",{className:"flex flex-col items-center gap-2 px-4",children:e.jsxs("div",{className:"flex h-20 w-full items-center justify-between rounded-lg bg-[#babfd1] px-4 text-gray-800",children:[e.jsxs("div",{className:"flex flex-col",children:[T>=0?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#9DBEBB",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-6 w-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-6 w-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 4.306 6.43l.776 2.898m0 0 3.182-5.511m-3.182 5.51-5.511-3.181"})}),e.jsx("div",{className:"text-sm font-semibold text-gray-800 sm:text-sm lg:text-lg",children:"淨現金流"})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("p",{className:"flex text-sm font-semibold sm:text-lg lg:text-xl",children:["NT$",c.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsxs("div",{className:`text-sm font-semibold ${T>=0,"text-gray-600"}`,children:[T>=0?"+":"",T.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"text-sm text-gray-600",children:M!=="N/A"?` ${M}%`:"0%"})]})]})})]})})}Be.register(cs,ds,xs,ms,us,fs);function Ps(){const{reportData:s}=P(),[r,l]=a.useState(0),i=()=>{r>0&&l(r-1)},n=()=>{r<s.length-1&&l(r+1)};if(!s||s.length===0)return e.jsxs("div",{className:"flex w-full items-center justify-center rounded-lg border bg-slate-500 p-6 text-white opacity-40 md:h-[595px]",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 h-12 w-12",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})}),e.jsx("p",{className:"ml-2",children:"無歷史報告數據"})]});const t=s[r]||{},c=(f,p)=>{const N={labels:[f,""],datasets:[{data:[p,100-p],backgroundColor:["#9DBEBB","#d6d6d6"],hoverBackgroundColor:["#9DBEBB","#eeeeee"],borderWidth:1}]},C={cutout:"60%",responsive:!0,plugins:{tooltip:{callbacks:{label:function(h){return`${h.label}: ${h.raw}%`}}},legend:{display:!1},datalabels:{display:!1,color:"#333",font:{weight:"bold",size:16},formatter:h=>`${h}`}}};return e.jsx(ct,{data:N,options:C})},m={labels:["財務狀況"],datasets:[{label:"每月收入",data:[t.monthincome||0],backgroundColor:"#9DBEBB"},{label:"每月支出",data:[t.monthexpense||0],backgroundColor:"#E8E9ED"},{label:"淨收入",data:[t.net||0],backgroundColor:"#BABFD1"}]},o={responsive:!0,scales:{y:{beginAtZero:!0,stacked:!0,ticks:{font:{size:16}}},x:{stacked:!0,ticks:{font:{size:16}}}},plugins:{legend:{display:!0},datalabels:{color:"#333",font:{weight:"bold",size:18},formatter:f=>`NT$${f}`}}},x=t.emergynumberrecommend||0,u=t.totalProperty||0,D={labels:["建議緊急備用金","總資產"],datasets:[{label:"NT$",data:[x,u],backgroundColor:["#BABFD1","#E8E9ED"],borderColor:["#A0A6B0","#D1D3D6"],borderWidth:1}]},d={layout:{padding:{right:120}},indexAxis:"y",scales:{x:{beginAtZero:!0,ticks:{font:{size:16}}},y:{beginAtZero:!0,ticks:{font:{size:16}}}},responsive:!0,plugins:{legend:{display:!1},datalabels:{color:"#333",font:{weight:"bold",size:16},anchor:"end",align:"right",clip:!1,offset:10,formatter:f=>`NT$${f}`}}};return e.jsxs("div",{className:"mb-[5vh] w-full",children:[e.jsxs("div",{className:"mx-auto mb-4 flex w-full flex-col gap-3",children:[e.jsxs("div",{className:"rounded-lg bg-[#fcfcfc] shadow-lg",children:[e.jsxs("h3",{className:"p-7 text-center text-xl font-semibold",children:[t.reportMonth.year," 年"," ",t.reportMonth.month," 月分析結果"]}),e.jsxs("div",{className:"flex w-full flex-col gap-3 p-7 md:flex-row",children:[e.jsxs("div",{className:"relative flex w-full items-center justify-center",children:[e.jsxs("div",{className:"absolute",children:[e.jsx("h4",{className:"text-center text-lg font-semibold",children:"房租率"}),e.jsx("p",{className:"text-3xl font-semibold text-[#9DBEBB]",children:isNaN(t.houseingRate)?"無數據":`${t.houseingRate}%`})]}),e.jsx("div",{className:"mx-auto h-56 w-56",children:c("房租率",isNaN(t.houseingRate)?0:t.houseingRate)})]}),e.jsxs("div",{className:"relative flex w-full items-center justify-center",children:[e.jsxs("div",{className:"absolute",children:[e.jsx("h4",{className:"text-center text-lg font-semibold",children:"保險率"}),e.jsx("p",{className:"text-3xl font-semibold text-[#9DBEBB]",children:isNaN(t.insureRate)?"無數據":`${t.insureRate}%`})]}),e.jsx("div",{className:"mx-auto h-56 w-56",children:c("房租率",isNaN(t.insureRate)?0:t.insureRate)})]}),e.jsxs("div",{className:"relative flex w-full items-center justify-center",children:[e.jsxs("div",{className:"absolute",children:[e.jsx("h4",{className:"text-center text-lg font-semibold",children:"儲蓄率"}),e.jsx("p",{className:"text-3xl font-semibold text-[#9DBEBB]",children:isNaN(t.savingRate)?"無數據":t.savingRate>30?`${t.savingRate}%`:t.savingRate<0?"支出超支":t.savingRate>0?`${t.savingRate}%`:""})]}),e.jsx("div",{className:"mx-auto h-56 w-56",children:c("儲蓄率",isNaN(t.savingRate)?0:t.savingRate>30?t.savingRate:t.savingRate<0?0:t.savingRate)})]})]})]}),e.jsxs("div",{className:"flex w-full flex-col gap-3 md:flex-row",children:[e.jsxs("div",{className:"flex w-full flex-col rounded-lg bg-[#fcfcfc] p-7 shadow-lg",children:[e.jsx("h4",{className:"mb-14 text-center text-xl font-semibold",children:"收支概況"}),e.jsx("div",{className:"flex h-auto justify-center lg:h-auto",children:e.jsx(tt,{data:m,options:o})})]}),e.jsxs("div",{className:"flex w-full flex-col rounded-lg bg-[#fcfcfc] p-7 shadow-lg",children:[e.jsx("h4",{className:"mb-14 text-center text-xl font-semibold",children:"財務數據"}),e.jsx("div",{className:"flex justify-center overflow-x-scroll lg:h-auto",children:e.jsx(tt,{data:D,options:d})})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(F,{onClick:i,disabled:r===0,variant:"grey",className:"disabled:bg-gray-300 disabled:text-white",children:"上一頁"}),e.jsxs("span",{className:"text-sm md:text-base",children:["第",r+1,"頁 / 共",s.length,"頁"]}),e.jsx(F,{onClick:n,disabled:r===s.length-1,variant:"retain",className:"disabled:bg-gray-300",children:"下一頁"})]})]})}function Ws(){return e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 fade-in",children:[e.jsx("h1",{className:"rounded-lg p-3 text-3xl font-semibold",children:"歡迎使用 MoneyTrack 財務分析功能"}),e.jsx("h2",{className:"px-3 text-xl",children:"我們將回顧前一個月的數據並進行客製化檢視"})]})}function kt({setSelectedHouseCategory:s,setSelectedInsureCategory:r,selectedInsureCategory:l,selectedHouseCategory:i}){const{classData:n}=P(),t=m=>{s(m)},c=m=>{r(m)};return kt.propTypes={setSelectedHouseCategory:w.func.isRequired,setSelectedInsureCategory:w.func.isRequired,selectedInsureCategory:w.string.isRequired,selectedHouseCategory:w.string.isRequired},e.jsxs("div",{className:"flex h-full flex-col items-center justify-center px-2 fade-in md:px-0 md:pt-10",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"設定統計數據"}),e.jsxs("div",{children:[e.jsx("h2",{className:"mb-1 mt-7 text-xl font-semibold",children:"1. 選擇您記帳使用的「房貸/房租」分類"}),e.jsx("p",{className:"text-lg text-gray-500",children:"後續步驟會為您計算房貸/租相關比率，因此您需要選擇記帳時自定義的分類！"}),e.jsxs("div",{className:"mt-4 flex space-x-2",children:[n.expense&&n.expense.map((m,o)=>e.jsx("button",{onClick:()=>t(m),className:`rounded-lg border px-4 py-2 ${i===m?"bg-[#545E75] text-gray-200":"bg-gray-200"}`,children:m},o)),e.jsx("button",{onClick:()=>t("無"),className:`rounded-lg border px-4 py-2 ${i==="無"?"bg-[#545E75] text-gray-200":"bg-gray-200"}`,children:"無"})]}),e.jsx("h2",{className:"mb-1 mt-7 text-xl font-semibold",children:"2. 選擇您紀錄「保險」支出的分類"}),e.jsx("p",{className:"text-lg text-gray-500",children:"後續步驟會為您計算保險相關比率，因此您需要選擇記帳時自定義的分類！"}),e.jsxs("div",{className:"mt-4 flex space-x-2",children:[n.expense&&n.expense.map((m,o)=>e.jsx("button",{onClick:()=>c(m),className:`rounded-lg border px-4 py-2 ${l===m?"bg-[#545E75] text-gray-200":"bg-gray-200"}`,children:m},o)),e.jsx("button",{onClick:()=>c("無"),className:`rounded-lg border px-4 py-2 ${l==="無"?"bg-[#545E75] text-gray-200":"bg-gray-200"}`,children:"無"})]})]})]})}function St({expenseTotals:s,incomeTotals:r,netWorth:l}){const{property:i}=P(),n=i.filter(c=>c.balance>0),t=i.filter(c=>c.balance<0);return St.propTypes={expenseTotals:w.object.isRequired,incomeTotals:w.object.isRequired,netWorth:w.object.isRequired},e.jsxs("div",{className:"flex flex-col items-center rounded-2xl px-2 pt-10 fade-in",children:[e.jsx("h2",{className:"mb-10 text-2xl font-semibold",children:"記帳數據"}),e.jsxs("div",{className:"flex h-72 w-full flex-col justify-center space-x-3 overflow-scroll pt-[450px] md:h-auto md:flex-row md:pt-0",children:[e.jsxs("div",{className:"flex flex-1 flex-col items-center",children:[e.jsx("h2",{className:"mb-5 text-xl font-semibold",children:"支出和收入"}),e.jsxs("div",{className:"h-[360px] w-full overflow-scroll",children:[Object.entries(s).map(([c,m])=>e.jsxs("div",{className:"m-1 flex items-center justify-between rounded-lg border bg-[#9dbebb] p-4 text-gray-800",children:[e.jsx("div",{className:"text-lg",children:c}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg",children:["NT$",m.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"self-end text-base",children:"支出"})]})]},c)),Object.entries(r).map(([c,m])=>e.jsxs("div",{className:"m-1 flex items-center justify-between rounded-lg border bg-[#e8e9ed] p-4 text-gray-800",children:[e.jsx("div",{className:"text-lg",children:c}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg",children:["NT$",m.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"self-end text-base",children:"收入"})]})]},c)),e.jsxs("div",{className:"m-1 flex items-center justify-between rounded-lg border bg-[#babfd1] p-4 text-gray-800",children:[e.jsx("div",{className:"h-6 text-lg",children:"投資&儲蓄"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg",children:["NT$",l.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("div",{className:"self-end text-base",children:"淨現金流"})]})]})]})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center",children:[e.jsx("h2",{className:"mb-5 text-xl font-semibold",children:"淨資產"}),e.jsxs("div",{className:"h-[360px] w-full overflow-scroll",children:[n.map(c=>e.jsxs("div",{className:"m-1 flex items-center justify-between rounded-lg border bg-[#e8e9ed] p-4 text-gray-800",children:[e.jsx("div",{className:"text-lg",children:c.account}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg",children:["NT$",c.balance.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsxs("div",{className:"self-end text-base",children:[c.account_type,"帳"]})]})]},c.account)),t.map(c=>e.jsxs("div",{className:"m-1 flex items-center justify-between rounded-lg border bg-[#aaaaaa] p-4 text-white",children:[e.jsx("div",{className:"text-lg",children:c.account}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg",children:["NT$",c.balance.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsxs("div",{className:"self-end text-base",children:[c.account_type,"帳"]})]})]},c.account))]})]})]})]})}function Dt({monthexpense:s,monthincome:r,expenseRecords:l,selectedHouseCategory:i,selectedInsureCategory:n,totalProperty:t,setTotalProperty:c,setSavingRate:m,savingRate:o}){const{property:x,loginEmail:u}=P(),{reportCollectionRef:D}=ne(u),[d,f]=a.useState(!0),[p,N]=a.useState(null);a.useEffect(()=>{const A=setTimeout(()=>{f(!1)},2e3);return()=>clearTimeout(A)},[]);const C=x.filter(A=>A.account_type==="儲蓄").reduce((A,b)=>A+b.balance,0);a.useEffect(()=>{const A=x.reduce((k,E)=>k+E.balance,0);c(A);const b=((r-s)/r*100).toFixed(0);m(b)},[s,r,m,c,x]);const h=l.filter(A=>A.class===i).reduce((A,b)=>A+b.amount,0),R=(l.filter(A=>A.class===n).reduce((A,b)=>A+b.amount,0)/r*100).toFixed(0),T=(h/r*100).toFixed(0),M=async()=>{const b="data:text/csv;charset=utf-8,"+[["健檢項目","總金額","說明"],["淨資產",`NT$${t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}`,""],["總支出",`-NT$${s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}`,""],["總收入",`NT$${r.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}`,""],["每月淨現金流",`NT$${r-s}`,"您每月可以存下的錢"],["儲蓄率",`${o}%`,o>30?"達標，高於30%":"未達標，建議高於 30%"],["房貸/房租率",`${T}%`,T<30?"達標，低於30%":"太高了，建議低於 30%"],["保險比例",`${R}%`,R<10?"達標，低於10%":"太高了，建議低於 10%"],["緊急預備金應有",`NT$${s*6}`,C>s*6?"達標，手上儲蓄超過這金額":`太低了，手上目前儲蓄有 NT$ ${C}`],["一年約能存",`NT$${(r-s)*12}`,""]].map(I=>I.join(",")).join(`
`),k=encodeURI(b),E=document.createElement("a");E.setAttribute("href",k),E.setAttribute("download","report.csv"),document.body.appendChild(E),E.click(),document.body.removeChild(E)},O=async()=>{const A=new Date,b=new Date(A.setMonth(A.getMonth()-1)),k=b.getFullYear(),E=b.getMonth()+1;try{await ye(D,{totalProperty:t,monthexpense:s,monthincome:r,savingRate:o,houseingRate:T,insureRate:R,emergynumberrecommend:s*6,net:r-s,reportMonth:{year:k,month:E},timestamp:new Date}),N("成功儲存")}catch(I){console.error("儲存到 Firebase 時發生錯誤：",I),alert("儲存時發生錯誤")}finally{f(!1)}};return Dt.propTypes={preText:w.func.isRequired,setPreText:w.func.isRequired,totalProperty:w.func.isRequired,setTotalProperty:w.func.isRequired,setSavingRate:w.func.isRequired,savingRate:w.func.isRequired,monthexpense:w.number.isRequired,monthincome:w.number.isRequired,expenseRecords:w.array.isRequired,selectedHouseCategory:w.string.isRequired,selectedInsureCategory:w.string.isRequired},e.jsxs("div",{className:"flex h-full flex-col items-center justify-center py-5 fade-in",children:[e.jsx("h2",{className:"pb-2 text-2xl font-bold",children:"報表"}),p&&e.jsx(he,{message:p,onClose:()=>N(null)}),d&&e.jsx("div",{className:"flex items-center justify-center",children:"載入中 ..."}),!d&&e.jsxs("div",{className:"w-full fade-in",children:[e.jsx("div",{className:"mb-1 h-80 overflow-scroll",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2",children:"健檢項目"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2",children:"總金額"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2",children:"說明"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"淨資產"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:["NT$",t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"總支出"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:["-NT$",s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"總收入"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:["NT$",r.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"每月淨現金流"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:["NT$",(r-s).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"您每月可以存下的錢"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"儲蓄率"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:isNaN(o)?"":o>30?`${o}%`:o<0?"支出超支":o>0?`${o}%`:"無儲蓄"}),e.jsx("td",{className:`border border-gray-300 px-4 py-2 ${o>30?"text-green-500":"text-red-600"}`,children:o>30?"達標，高於30%":"未達標，建議高於 30%"})]}),i!=="無"?e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"房貸/房租率"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:isNaN(T)?"無數據":`${T}%`}),e.jsx("td",{className:`border border-gray-300 px-4 py-2 ${T<30?"text-green-500":"text-red-600"}`,children:T<30?"達標，低於30%":"太高了，建議低於 30%"})]}):e.jsx(e.Fragment,{}),n!=="無"?e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"保險比例"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:isNaN(R)?"無數據":`${R}%`}),e.jsx("td",{className:`border border-gray-300 px-4 py-2 ${R<10?"text-green-500":"text-red-600"}`,children:R<10?"達標，低於10%":"太高了，建議低於 10%"})]}):e.jsx(e.Fragment,{}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"緊急預備金應有"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:["NT$",s*6]}),e.jsx("td",{className:`border border-gray-300 px-4 py-2 ${C>s*6?"text-green-500":"text-red-600"}`,children:C>s*6?"達標，手上儲蓄超過這金額":`太低了，手上目前儲蓄有 NT$ ${C.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}`})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:"一年約能存"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2",children:["NT$",(r-s)*12]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2"})]})]})]})}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:M,className:"mt-1 rounded-lg bg-[#9DBEBB] p-2 text-white",children:"下載 CSV"}),e.jsx("button",{onClick:O,className:"ml-4 mt-1 rounded-lg bg-[#607196] p-2 text-white",children:"儲存報表"})]})]})]})}function At({preText:s,setPreText:r}){const[l,i]=a.useState([]),[n,t]=a.useState(""),[c,m]=a.useState(!1);a.useEffect(()=>{s&&(o(s),r(""))},[s,r]);const o=async d=>{m(!0);try{const f=await fetch("https://chat-ufdrsceebq-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"你是一個使用繁體中文回應的理財規劃師。如果有其他跟理財不相關的話題，請一律表示無法回答。"},{role:"user",content:d}]})});if(!f.ok)throw new Error("Network response was not ok");const p=await f.json();i(N=>[...N,{role:"assistant",content:p.botMessage.content||p.botMessage}])}catch(f){console.error("Error:",f)}finally{m(!1)}},x=async d=>{const f=[...l,{role:"user",content:d}];i(f),t("");try{const p=await fetch("https://chat-ufdrsceebq-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:"你是一隻會使用繁體中文回應的理財貓，專長是理財與財經問題。如果有其他跟理財不相關的話題，請一律表示無法回答，包括各種道德困境、人生抉擇，總之非理財不要問。"},...f]})});if(!p.ok)throw new Error("Network response was not ok");const N=await p.json();i(C=>[...C,{role:"assistant",content:N.botMessage.content||N.botMessage}])}catch(p){console.error("Error:",p)}},u=a.useRef(null),D=()=>{u.current&&u.current.scrollIntoView({behavior:"smooth"})};return a.useEffect(()=>{D()},[l]),At.propTypes={preText:w.func.isRequired,setPreText:w.func.isRequired},e.jsx("div",{className:"h-full w-full p-1 fade-in",children:e.jsxs("div",{className:"relative flex h-full flex-col rounded-lg bg-slate-300 p-4",children:[c&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center",children:[e.jsx("h2",{className:"pb-2 text-2xl font-bold",children:"理財貓"}),e.jsx("div",{children:"分析中 ..."})]}),e.jsxs("div",{className:"w-full space-y-1 overflow-auto text-xl",children:[l.map((d,f)=>e.jsx("div",{className:`flex ${d.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] rounded-lg p-3 text-white ${d.role==="user"?"bg-[#222E50]":"bg-[#82A0BC] text-black"}`,children:[e.jsx("strong",{children:d.role==="user"?"":"理財貓  : "})," ",d.content]})},f)),e.jsx("div",{ref:u})]}),e.jsx("div",{className:"mt-16",children:e.jsxs("div",{className:"absolute bottom-3 mt-5 flex w-full justify-center gap-2",children:[e.jsx("input",{className:"h-12 w-[200px] rounded-lg border border-black pl-2 md:w-[700px]",value:n,onChange:d=>t(d.target.value),onKeyPress:d=>d.key==="Enter"&&x(n)}),e.jsx(F,{onClick:()=>x(n),variant:"retain",children:"傳送"})]})})]})})}function Is(){const{setAnalysisRun:s}=pe();a.useEffect(()=>{localStorage.getItem("hasSeenAnalysisTutorial")||(s(!0),localStorage.setItem("hasSeenAnalysisTutorial","true"))},[s]);const r=()=>{s(!0)},[l,i]=a.useState(!1),[n,t]=a.useState(1),[c,m]=a.useState(0),[o,x]=a.useState(0),[u,D]=a.useState({}),[d,f]=a.useState(0),[p,N]=a.useState(0),[C,h]=a.useState({}),[j,R]=a.useState({}),[T,M]=a.useState(0),[O,A]=a.useState(""),[b,k]=a.useState(""),[E,I]=a.useState(""),[V,Z]=a.useState(null),[H,J]=a.useState({isOpen:!1,message:"",onConfirm:null,cancelMessage:"取消",confirmMessage:"確認"}),[re,X]=a.useState(!0),ee=()=>{Number(c)===0&&Number(o)===0?Z("上月無數據可進行分析"):i(!0)},ce=()=>{if(n===2&&(!O||!b)){Z("請選擇房屋類別和保險類別才能進入下一步！");return}if(n===3){J({isOpen:!0,message:"即將生成報表，確認後不可返回",onConfirm:()=>{J({...H,isOpen:!1}),t(S=>S+1)},cancelMessage:"取消",confirmMessage:"確認"});return}if(n===4){J({isOpen:!0,message:"理財貓規劃師即將替您分析，進入後不可返回",onConfirm:()=>{I(`我的淨資產有 NT$${d}，上月總支出 NT$${c}、總收入 NT$${o}，儲蓄率是 ${p}%，大家都說緊急備用金要是生活費的 6 個月，我目前的狀況是這樣，請給我一些理財建議！`),J({...H,isOpen:!1}),t(S=>S+1)},cancelMessage:"取消",confirmMessage:"確認"});return}t(S=>S+1)},y=()=>{t(S=>Math.max(S-1,1))},v=()=>{J({isOpen:!0,message:"離開後需重新進入，確定離開嗎",cancelMessage:"取消",confirmMessage:"確認",onConfirm:()=>{J({...H,isOpen:!1}),i(!1),t(1),A(""),k("")}})},g=()=>{J({isOpen:!0,message:"離開視窗後將關閉諮詢室，確定離開嗎",onConfirm:()=>{J({...H,isOpen:!1}),i(!1),t(1),A(""),k("")},cancelMessage:"取消",confirmMessage:"確認"})},L=()=>{switch(n){case 1:return e.jsx(Ws,{});case 2:return e.jsx(kt,{setSelectedHouseCategory:A,setSelectedInsureCategory:k,selectedHouseCategory:O,selectedInsureCategory:b});case 3:return e.jsx(St,{expenseTotals:C,incomeTotals:j,netWorth:T});case 4:return e.jsx(Dt,{monthexpense:c,monthincome:o,selectedHouseCategory:O,expenseRecords:u,selectedInsureCategory:b,setTotalProperty:f,setSavingRate:N,savingRate:p,totalProperty:d});case 5:return e.jsx(At,{preText:E,setPreText:I});default:return null}};return e.jsxs("div",{className:"flex w-[85%] flex-col items-center",children:[V&&e.jsx(he,{message:V,onClose:()=>Z(null)}),e.jsx(zs,{}),e.jsxs("div",{className:"mb-3 flex w-full items-center justify-between gap-1 rounded-lg bg-[#fcfcfc] p-4 shadow-lg md:gap-2",children:[e.jsxs("div",{className:"relative flex gap-2 border-b border-gray-300",children:[e.jsx("button",{onClick:()=>X(!0),className:`text-sm font-semibold md:text-base ${re?"scale-105 border-b-2 border-[#607196] text-[#607196]":"text-gray-400"} transform px-2 py-1 transition duration-300 ease-in-out md:px-4 md:py-2`,children:"即時數據"}),e.jsx("button",{onClick:()=>X(!1),className:`joyride-report text-sm font-semibold md:text-base ${re?"text-gray-400":"scale-105 border-b-2 border-[#607196] text-[#607196]"} transform px-2 py-1 transition duration-300 ease-in-out md:px-4 md:py-2`,children:"歷史報告"})]}),e.jsxs("div",{className:"flex gap-2",children:[re?e.jsx(e.Fragment,{children:e.jsxs(F,{className:"flex cursor-pointer items-center justify-center gap-1 md:gap-2",variant:"grey",onClick:()=>r(),children:[e.jsx("p",{className:"hidden text-sm md:block md:text-base",children:"使用教學"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"yellow",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})})]})}):e.jsx(e.Fragment,{}),e.jsxs(F,{className:"joyride-generatereport flex cursor-pointer items-center justify-center gap-1 md:gap-2",variant:"retain",onClick:()=>ee(),children:[e.jsx("p",{className:"hidden text-sm md:block md:text-base",children:"我要進行分析"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z"})})]})]})]}),re?e.jsxs("div",{className:"mx-auto flex h-auto w-full flex-col justify-center gap-3 md:flex-row",children:[e.jsx("div",{className:"joyride-monthlydata w-full",children:e.jsx(Ct,{setmonthExpense:m,setmonthIncome:x,expenseTotals:C,setExpenseTotals:h,incomeTotals:j,setIncomeTotals:R,netWorth:T,setNetWorth:M,setExpenseRecords:D,expenseRecords:u})}),e.jsx("div",{className:"joyride-balancesheet mb-[10vh] w-full md:mb-0",children:e.jsx(Os,{totalProperty:d})})]}):e.jsx(e.Fragment,{children:e.jsx(Ps,{})}),l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75 px-2",children:e.jsxs("div",{className:"h-auto w-full max-w-6xl rounded-lg bg-white p-6 shadow-lg md:h-[720px]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2 flex justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["生成報表 - 步驟 ",n,"/5"]}),V&&e.jsx(he,{message:V,onClose:()=>Z(null)}),H.isOpen&&e.jsx(Fe,{message:H.message,onConfirm:()=>{H.onConfirm()},onCancel:()=>J({...H,isOpen:!1}),cancelMessage:H.cancelMessage,confirmMessage:H.confirmMessage}),e.jsx(F,{onClick:v,children:"取消"})]}),e.jsx("div",{className:"mb-4 flex justify-between",children:Array.from({length:5},(S,B)=>e.jsx("div",{className:`mx-1 h-3 flex-1 rounded-lg ${B+1<=n?"border-2 border-[#aaaaaa] bg-[#aaaaaa]":"border border-[#aaaaaa]"}`},B))})]}),e.jsx("div",{className:"h-[540px] overflow-hidden rounded-lg border-2 border-gray-500",children:L()}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx(F,{onClick:y,variant:"prevstep",disabled:n===1||n===4||n===5,children:"上一步"}),n===5?e.jsx(F,{onClick:g,variant:"retain",children:"結束健檢分析"}):e.jsx(F,{onClick:ce,variant:"retain",disabled:n===5,children:"下一步"})]})]})})]})}function qs(){const[s,r]=a.useState(!0),{transactionData:l}=P(),[i,n]=a.useState(!0);return a.useEffect(()=>{if(Array.isArray(l)&&l.length===0&&i){const t=setTimeout(()=>{r(!1),n(!1)},2500);return()=>clearTimeout(t)}else Array.isArray(l)&&l.length>0&&(r(!1),n(!1))},[l]),s&&i?e.jsx("div",{className:"w-full pt-5",children:e.jsxs("div",{className:"mx-auto mb-[10vh] flex w-[85%] flex-col pl-11 md:pl-0",children:[e.jsx(K,{height:72,width:"100%"}),e.jsxs("div",{className:"mt-2 flex w-full flex-col gap-2 md:flex-row",children:[e.jsx("div",{className:"h-[300px] w-full md:h-[700px]",children:e.jsx(K,{height:"100%","flex-grow":!0})}),e.jsx("div",{className:"h-[300px] w-full md:h-[700px]",children:e.jsx(K,{height:"100%","flex-grow":!0})})]})]})}):e.jsx("div",{className:"flex w-full flex-col items-center bg-gradient-to-r from-[#e3e3e3] via-[#efefef] to-[#e3e3e3] pl-11 pt-5 fade-in md:pl-0",children:e.jsx(Is,{})})}function me(...s){return gs(hs(s))}const Tt=a.forwardRef(({className:s,...r},l)=>e.jsx("div",{ref:l,className:me("rounded-lg border border-stone-200 bg-white text-stone-950 shadow-sm dark:border-stone-800 dark:bg-stone-950 dark:text-stone-50",s),...r}));Tt.displayName="Card";const Hs=a.forwardRef(({className:s,...r},l)=>e.jsx("div",{ref:l,className:me("flex flex-col space-y-1.5 p-6",s),...r}));Hs.displayName="CardHeader";const Vs=a.forwardRef(({className:s,...r},l)=>e.jsx("h3",{ref:l,className:me("text-2xl font-semibold leading-none tracking-tight",s),...r}));Vs.displayName="CardTitle";const _s=a.forwardRef(({className:s,...r},l)=>e.jsx("p",{ref:l,className:me("text-sm text-stone-500 dark:text-stone-400",s),...r}));_s.displayName="CardDescription";const Lt=a.forwardRef(({className:s,...r},l)=>e.jsx("div",{ref:l,className:me("p-6 pt-0",s),...r}));Lt.displayName="CardContent";const Zs=a.forwardRef(({className:s,...r},l)=>e.jsx("div",{ref:l,className:me("flex items-center p-6 pt-0",s),...r}));Zs.displayName="CardFooter";const Js="/assets/analysis-CQfHHobl.gif",Gs="/assets/banner-Scp0X7B_.jpg",Us="/assets/chart-CnTzL1Ea.gif",Ys="/assets/project-CM02b2_7.gif",Qs=async()=>{const s=new at;try{const l=(await nt(De,s)).user,i=l.email,n=ie(de,"record",i);try{await xe(n,{createdAt:new Date,userEmail:i})}catch(t){t.code==="not-found"?await Me(n,{createdAt:new Date,userEmail:i}):console.error("更新失敗",t)}localStorage.setItem("userEmail",i),localStorage.setItem("user",l.displayName),window.location.href="/property"}catch(r){console.error("登入失敗",r.code,r.message,r.email,r.credential)}},Ks=bs("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stone-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-stone-950 dark:focus-visible:ring-stone-300",{variants:{variant:{default:"bg-stone-900 text-stone-50 hover:bg-stone-900/90 dark:bg-stone-50 dark:text-stone-900 dark:hover:bg-stone-50/90",destructive:"bg-red-500 text-stone-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-stone-50 dark:hover:bg-red-900/90",outline:"border border-stone-200 bg-white hover:bg-stone-100 hover:text-stone-900 dark:border-stone-800 dark:bg-stone-950 dark:hover:bg-stone-800 dark:hover:text-stone-50",secondary:"bg-stone-100 text-stone-900 hover:bg-stone-100/80 dark:bg-stone-800 dark:text-stone-50 dark:hover:bg-stone-800/80",ghost:"hover:bg-stone-100 hover:text-stone-900 dark:hover:bg-stone-800 dark:hover:text-stone-50",link:"text-stone-900 underline-offset-4 hover:underline dark:text-stone-50"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ge=a.forwardRef(({className:s,variant:r,size:l,asChild:i=!1,...n},t)=>{const c=i?js:"button";return e.jsx(c,{className:me(Ks({variant:r,size:l,className:s})),ref:t,...n})});Ge.displayName="Button";const Rt=a.createContext(null);function Oe(){const s=a.useContext(Rt);if(!s)throw new Error("useCarousel must be used within a <Carousel />");return s}const Mt=a.forwardRef(({orientation:s="horizontal",opts:r,setApi:l,plugins:i,className:n,children:t,...c},m)=>{const[o,x]=ps({...r,axis:s==="horizontal"?"x":"y"},i),[u,D]=a.useState(!1),[d,f]=a.useState(!1),p=a.useCallback(j=>{j&&(D(j.canScrollPrev()),f(j.canScrollNext()))},[]),N=a.useCallback(()=>{x==null||x.scrollPrev()},[x]),C=a.useCallback(()=>{x==null||x.scrollNext()},[x]),h=a.useCallback(j=>{j.key==="ArrowLeft"?(j.preventDefault(),N()):j.key==="ArrowRight"&&(j.preventDefault(),C())},[N,C]);return a.useEffect(()=>{!x||!l||l(x)},[x,l]),a.useEffect(()=>{if(x)return p(x),x.on("reInit",p),x.on("select",p),()=>{x==null||x.off("select",p)}},[x,p]),e.jsx(Rt.Provider,{value:{carouselRef:o,api:x,opts:r,orientation:s||((r==null?void 0:r.axis)==="y"?"vertical":"horizontal"),scrollPrev:N,scrollNext:C,canScrollPrev:u,canScrollNext:d},children:e.jsx("div",{ref:m,onKeyDownCapture:h,className:me("relative",n),role:"region","aria-roledescription":"carousel",...c,children:t})})});Mt.displayName="Carousel";const Et=a.forwardRef(({className:s,...r},l)=>{const{carouselRef:i,orientation:n}=Oe();return e.jsx("div",{ref:i,className:"overflow-hidden",children:e.jsx("div",{ref:l,className:me("flex",n==="horizontal"?"-ml-4":"-mt-4 flex-col",s),...r})})});Et.displayName="CarouselContent";const Bt=a.forwardRef(({className:s,...r},l)=>{const{orientation:i}=Oe();return e.jsx("div",{ref:l,role:"group","aria-roledescription":"slide",className:me("min-w-0 shrink-0 grow-0",i==="horizontal"?"pl-4":"pt-4",s),...r})});Bt.displayName="CarouselItem";const $t=a.forwardRef(({className:s,variant:r="outline",size:l="icon",...i},n)=>{const{orientation:t,scrollPrev:c,canScrollPrev:m}=Oe();return e.jsxs(Ge,{ref:n,variant:r,size:l,className:me("absolute h-8 w-8 rounded-full",t==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!m,onClick:c,...i,children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});$t.displayName="CarouselPrevious";const Ft=a.forwardRef(({className:s,variant:r="outline",size:l="icon",...i},n)=>{const{orientation:t,scrollNext:c,canScrollNext:m}=Oe();return e.jsxs(Ge,{ref:n,variant:r,size:l,className:me("absolute h-8 w-8 rounded-full",t==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!m,onClick:c,...i,children:[e.jsx(ws,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});Ft.displayName="CarouselNext";function Xs(){const{ref:s,inView:r}=st({triggerOnce:!0,threshold:.3}),{ref:l,inView:i}=st({triggerOnce:!0,threshold:.3}),n=a.useRef(null),[t,c]=a.useState(0),m=window.innerHeight,[o,x]=a.useState(!0);a.useEffect(()=>{const d=()=>{if(n.current){const f=window.scrollY,p=window.innerHeight,N=f-p,C=Math.floor(N/m);C!==t&&C>=0&&C<u.length&&(x(!1),setTimeout(()=>{c(C),x(!0)},300))}};return window.addEventListener("scroll",d),()=>{window.removeEventListener("scroll",d)}},[t,m]);const u=[{img:Us,text:"我的支出都花在哪？",content:"多圖表分析",contenttwo:"支出收入一目瞭然",smalltext:"各式數據圖表，讓您快速掌握每月的消費習慣！",smalltexttwo:"此外，切換月份檢視各項交易紀錄，轉帳編輯樣樣來！"},{img:Js,text:"我想要客製化的理財方向",content:"專屬理財規劃師",contenttwo:"提供最專業的諮詢",smalltext:"透過數據報表，分析您每月的支出收入比率、淨資產分佈。",smalltexttwo:"最客製化的分析建議，讓您不再對理財毫無頭緒。"},{img:Ys,text:"我出去玩不知道花了多少錢",content:"開啟記帳專案",contenttwo:"掌握您金錢的流向",smalltext:"擁有理財專案功能，不管是出遊、結婚、個人儲蓄計畫，",smalltexttwo:"通通交給我們，讓您人生的路上，你不孤單。"}],D=[{name:"炸毛企鵝",review:"MoneyTrack 真的很好用！它幫助我檢視我每天的支出，現在媽媽問我錢花到哪去的時候，我不會在支吾其詞了。謝謝 MoneyTrack 改變我的習慣！",avatar:"https://diz36nn4q02zr.cloudfront.net/webapi/imagesV3/Original/SalePage/9250833/0/638606291718370000?v=1"},{name:"豆仔",review:"網頁易於使用且非常直觀，我特別喜歡其帳戶整合功能！以前都不知道自己到底有多少錢錢在身上，總覺得花都花不完，不知不覺就變月光族了。",avatar:"https://diz36nn4q02zr.cloudfront.net/webapi/imagesV3/Original/SalePage/9556147/0/638437633877100000?v=1"},{name:"棒球",review:"真的太方便了！離線功能非常實用，我常常去到網路很差的咖啡館，每次都會忘記記帳，後面就越來越懶，現在不管是上山下海，我都可以輕鬆地使用 MoneyTrack。",avatar:"https://diz36nn4q02zr.cloudfront.net/webapi/imagesV3/Original/SalePage/9890484/0/638556196343770000?v=1"},{name:"沙堡",review:"我覺得介面其實很好看！而且最特別的是分析功能，居然可以知道我的哪些理財習慣是不好的，真的是太酷了，推薦給所有朋友，一起來用看看吧！",avatar:"https://diz36nn4q02zr.cloudfront.net/webapi/imagesV3/Original/SalePage/9733662/0/638610363440700000?v=1"},{name:"蘆薈",review:"我非常滿意這個產品的使用體驗，自從我開始使用記帳後，我發現自己的理財習慣真的改變了！我不再不知道錢花到哪和放到哪，真的很棒！",avatar:"https://diz36nn4q02zr.cloudfront.net/webapi/imagesV3/Original/SalePage/9597532/0/638500929989470000?v=1"},{name:"扇貝",review:"真的太方便了！離線功能非常實用，我常常去到網路很差的咖啡館，每次都會忘記記帳，後面就越來越懶，現在不管是上山下海，我都會使用 MoneyTrack。",avatar:"https://assets.breezeonline.com/online/production/product/bbda77f3-2434-4969-99d4-dd4788e5b0ba.jpg"},{name:"抹茶山",review:"MoneyTrack 真的很好用！它幫助我檢視我每天的支出，現在爸爸問我錢花到哪去的時候，我不會在支吾其詞了。謝謝 MoneyTrack 改變我的習慣！",avatar:"https://s2.eslite.com/unsafe/fit-in/x900/s.eslite.com/b2b/newItem/2024/08/01/988_153457412_595_mainCoverImage1.jpg"}];return e.jsxs("div",{className:"landing-page",children:[e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"h-[80vh] w-full overflow-hidden object-cover text-center",style:{backgroundImage:`url(${Gs})`,backgroundSize:"cover",backgroundRepeat:"no-repeat"},children:e.jsxs("div",{className:"ml-[5vw] mt-[10vh] flex flex-col items-start gap-4 pr-6 sm:p-0 xl:mt-[17vh] 3xl:mt-[20vh]",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl text-[#9DBEBB] xs:text-3xl xl:text-4xl",children:"用戶"}),e.jsx("h1",{className:"text-2xl text-white xs:text-3xl xl:text-4xl",children:"好評推薦"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("svg",{fill:"rgb(246, 168, 45)",strokeWidth:"0",viewBox:"0 0 576 512",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"})}),e.jsx("svg",{fill:"rgb(246, 168, 45)",strokeWidth:"0",viewBox:"0 0 576 512",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"})}),e.jsx("svg",{fill:"rgb(246, 168, 45)",strokeWidth:"0",viewBox:"0 0 576 512",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"})}),e.jsx("svg",{fill:"rgb(246, 168, 45)",strokeWidth:"0",viewBox:"0 0 576 512",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"})}),e.jsx("svg",{fill:"rgb(246, 168, 45)",strokeWidth:"0",viewBox:"0 0 576 512",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"})})]})]}),e.jsx("h1",{className:"mt-4 text-3xl font-semibold text-[#bbe0e1] xs:text-4xl xl:text-5xl",children:"最創新的理財記帳網頁"}),e.jsx("h1",{className:"mt-2 text-white xl:text-xl",children:"最多元的資產管理平台，最方便的記帳工具， 最完整的智慧分析。"}),e.jsx("button",{className:"rounded-lg bg-[#fcfcfc] px-2 py-4 font-semibold text-[#446f5c]",onClick:Qs,children:"立刻免費註冊"})]})})}),e.jsxs("div",{children:[e.jsx("section",{className:"h-[350vh]",children:e.jsx("div",{ref:n,className:"sticky top-0 flex h-screen flex-col items-center justify-center overflow-hidden bg-[#fafafa] pt-[20vh] lg:pt-0",children:e.jsxs("div",{className:`mb-44 flex h-screen w-screen flex-col items-center justify-center gap-20 transition-opacity duration-500 ${o?"opacity-100":"opacity-0"} lg:mb-0 lg:flex-row lg:pr-28 xl:gap-28`,children:[e.jsx("img",{src:u[t].img,alt:"",className:"h-[250px] w-auto xs:h-[350px] sm:h-[400px] lg:h-[300px] xl:h-[500px] 2xl:h-[550px] 3xl:h-[630px]"}),e.jsxs("div",{className:"flex w-[340px] flex-col flex-nowrap xs:w-[400px]",children:[e.jsx("p",{className:"mb-4 text-xl font-semibold text-[#bbe0e1] sm:text-2xl xl:text-3xl",children:u[t].text}),e.jsxs("p",{className:"text-nowrap text-4xl font-semibold xs:text-5xl xs:leading-tight 3xl:text-6xl 3xl:leading-snug",children:[u[t].content,e.jsx("br",{}),u[t].contenttwo]}),e.jsxs("p",{className:"mt-4 text-sm leading-snug text-[#374151] xs:text-lg xl:text-2xl",children:[u[t].smalltext,u[t].smalltexttwo]})]}),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:u.map((d,f)=>e.jsx("div",{className:`mx-2 h-2 w-2 rounded-full transition duration-300 xl:h-3 xl:w-3 ${t===f?"bg-gray-600":"bg-gray-400"}`},f))})]})})}),e.jsx("section",{className:"h-auto bg-[#fafafa] pt-[10vh] lg:pt-0",children:e.jsxs("div",{className:"flex h-full flex-col items-center gap-7",children:[e.jsx("h1",{className:"text-4xl font-semibold lg:text-6xl",children:"更多特色"}),e.jsx("div",{className:"flex h-[50%] flex-col items-center gap-3 rounded-lg lg:flex-row",children:[{title:"自定義佈局",description:"財務儀表板擺脫傳統排版，您可以根據自己習慣、喜歡的使用方式去拖拉介面，讓記帳更輕鬆！",svg:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"rgb(246, 168, 45)",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor",className:"size-8 lg:size-11",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})})},{title:"帳戶整合",description:"統整各帳戶、信用卡的資產分佈，並且可以查看帳戶底下的交易紀錄，隨時進行淨資產統計。",svg:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"rgb(246, 168, 45)",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor",className:"size-8 lg:size-11",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z"})})},{title:"離線使用",description:"經常在餐廳連不到網路嗎? MoneyTrack 離線時也能繼續使用，您再也找不到不記帳的藉口！",svg:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"rgb(246, 168, 45)",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor",className:"size-8 lg:size-11",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z"})]})},{title:"轉帳交易",description:"在 MoneyTrack 中您可以輕鬆紀錄轉帳，因為我們提供「轉帳」功能，讓你資產轉移不再煩惱！",svg:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"rgb(246, 168, 45)",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor",className:"size-8 lg:size-11",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}].map(({title:d,description:f,svg:p},N)=>e.jsxs("div",{ref:s,className:`flex h-full w-[80vw] transform flex-col items-center justify-center gap-3 rounded-3xl border bg-white px-7 py-3 text-3xl shadow-md transition duration-700 hover:bg-gray-100 lg:w-[20vw] lg:gap-5 ${r?"translate-y-0 opacity-100":"translate-y-10 opacity-0"}`,children:[p,e.jsx("p",{className:"flex items-center text-xl font-semibold lg:text-2xl",children:d}),e.jsx("p",{className:"text-base text-[#374151] xl:text-lg",children:f})]},N))})]})}),e.jsx("section",{className:"h-auto bg-[#fafafa] py-[10vh]",children:e.jsxs("div",{className:"flex h-full flex-col items-center gap-5",children:[e.jsx("h1",{className:"text-4xl font-semibold lg:text-6xl",children:"好評推薦"}),e.jsx("h2",{className:"ml-[5vh] self-start rounded-lg bg-[#bbe0e1] p-2 font-semibold text-white sm:ml-[10vh] lg:ml-[20vh]",children:"MoneyTrack 用戶這麽說"}),e.jsx("h2",{className:"mb-2 ml-[5vh] self-start rounded-lg px-2 font-semibold sm:ml-[10vh] lg:ml-[20vh] lg:text-xl",children:"使用者真實評價"}),e.jsxs(Mt,{className:"max-w-7xl lg:w-[80vw]",children:[e.jsx(Et,{className:"mx-auto w-[60vw] sm:w-[80vw] lg:w-[50vw]",children:D.map((d,f)=>e.jsx(Bt,{children:e.jsx(Tt,{className:`m-2 h-96 w-48 rounded-3xl border bg-white shadow-md transition duration-700 sm:h-80 sm:w-72 lg:h-96 lg:w-72 ${i?"translate-y-0 opacity-100":"translate-y-10 opacity-0"}`,children:e.jsxs(Lt,{className:"flex h-full flex-col items-center justify-center gap-3 p-7",children:[e.jsx("img",{src:d.avatar,alt:`${d.name} avatar`,className:"mb-4 h-16 w-16 rounded-full md:h-24 md:w-24"}),e.jsx("p",{className:"text-lg font-semibold md:text-2xl",children:d.name}),e.jsx("p",{className:"justify-self-start text-base text-gray-700 lg:text-lg",children:d.review})]})})},f))}),e.jsx($t,{}),e.jsx(Ft,{})]}),e.jsx("div",{ref:l})]})}),e.jsx("section",{className:"flex h-auto flex-col items-center justify-center gap-10 bg-[#222E50] p-7 text-sm text-white lg:text-lg",children:e.jsx("p",{className:"",children:"© 2024 MoneyTrack Corp., Ltd. All rights reserved."})})]})]})}function er(){return e.jsxs(e.Fragment,{children:[e.jsx(Je,{}),e.jsx(Xs,{})]})}const tr=()=>{const{projectRun:s,setProjectRun:r,stepProjectIndex:l,setStepProjectIndex:i,projectSteps:n}=pe(),{setAccounting:t}=P();a.useEffect(()=>{localStorage.getItem("hasSeenProjectTutorial")?(r(!1),i(0)):r(!0)},[r,i]);const c=m=>{const{action:o,index:x,status:u,type:D,lifecycle:d}=m;if(u==="finished"||u==="skipped"||D==="close"||o==="close"&&d==="complete")r(!1),i(0),t(!1),localStorage.setItem("hasSeenProjectTutorial","true");else if(D==="step:after"&&(o==="next"||o==="prev")){const f=x+(o==="next"?1:-1);switch(i(f),f){case 1:o==="prev"&&t(!1);break;case 2:o==="next"&&(t(!0),setTimeout(()=>{r(!0)},500));break;case 3:o==="next"?(t(!1),setTimeout(()=>{r(!0)},500)):o==="prev"&&(t(!0),setTimeout(()=>{r(!0)},500));break;case 4:o==="next"?t(!1):o==="prev"&&t(!0);break}}};return e.jsx(Ee,{run:s,steps:n,stepIndex:l,continuous:!0,showSkipButton:!0,callback:c,disableBeacon:!0,disableScrolling:!0,spotlightClicks:!1,disableOverlayClose:!0,styles:{options:{zIndex:1e4,arrowColor:"#f2f2f2",backgroundColor:"#f2f2f2",textColor:"#333",overlayColor:"rgba(0, 0, 0, 0.5)",primaryColor:"#4a90e2",placement:"bottom"},spotlight:{borderRadius:"8px"},tooltip:{fontSize:"18px",fontWeight:"bold",backgroundColor:"#f2f2f2",borderRadius:"8px",color:"#333",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"},buttonNext:{backgroundColor:"#607196",color:"#fff",borderRadius:"8px"},buttonBack:{color:"#888",marginRight:"10px"},buttonSkip:{color:"#f03e3e"}}})};function sr(){const{setProjectRun:s}=pe();a.useEffect(()=>{localStorage.getItem("hasSeenProjectTutorial")||(s(!0),localStorage.setItem("hasSeenProjectTutorial","true"))},[s]);const r=()=>{s(!0)},[l,i]=a.useState([]),[n,t]=a.useState(!1),[c,m]=a.useState(null),[o,x]=a.useState(null),[u,D]=a.useState(null),[d,f]=a.useState(),[p,N]=a.useState(!1),[C,h]=a.useState(!1),{loginEmail:j}=P(),{transactionData:R}=P(),{projectCollectionRef:T,accountingCollectionRef:M}=ne(j),{register:O,handleSubmit:A,reset:b,formState:{errors:k}}=Ae({defaultValues:{projectname:"",projectimage:null}}),[E,I]=a.useState(null);a.useEffect(()=>{(async()=>{try{const S=(await ae(T)).docs.map(B=>({id:B.id,...B.data()}));i(S)}catch(L){console.error("Error fetching projects: ",L)}})()},[T]);const V=()=>{t(!0)},Z=async g=>{if(!C){h(!0);try{let L=null;if(g.projectimage&&g.projectimage[0]){const q=g.projectimage[0],W=rs(Cs,`project-images/${q.name}`),G=await as(W,q);L=await ns(G.ref)}const S={name:g.projectname,imageUrl:L,isediting:!0,created_at:lt()};t(!1),b(),I("新增成功"),m(null);const B=await ye(T,S);await xe(B,{id:B.id}),i([...l,{id:B.id,...S}])}catch(L){console.error("Error adding project: ",L)}finally{h(!1)}}},H=g=>{const L=g.target.files[0];m(URL.createObjectURL(L))},J=()=>{t(!1),m(null),b()},re=(g,L)=>{x(g);const S=R.filter(W=>W.projectid===L),B=S.sort((W,G)=>G.time.toDate()-W.time.toDate());x(g),D(B);const q=S.reduce((W,G)=>G.record_type==="支出"?W-G.convertedAmountTWD:G.record_type==="收入"?W+G.convertedAmountTWD:W,0);return f(q),S},X=async(g,L)=>{try{if(g==="保留帳單")await ge(ie(T,L));else if(g==="刪除帳單"){await ge(ie(T,L));const S=oe(M,_("projectid","==",o.id));(await ae(S)).forEach(async q=>{await ge(ie(M,q.id))})}i(l.filter(S=>S.id!==L)),x(null),D(null),I("專案已刪除"),p(!1)}catch(S){console.error("Error deleting project: ",S)}},ee=()=>{x(null),D(null)},ce=async g=>{try{const L=ie(T,g);x(null),D(null),I("已關閉專案"),await xe(L,{isediting:!1})}catch(L){console.error("Error deleting project: ",L)}},[y,v]=a.useState(!0);return e.jsxs(e.Fragment,{children:[E&&e.jsx(he,{message:E,onClose:()=>I(null)}),e.jsx(tr,{}),e.jsx("div",{className:"w-[85%] py-5",children:e.jsxs("div",{className:"flex h-auto flex-col flex-wrap items-start justify-start gap-4",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2 self-end rounded-lg bg-[#fcfcfc] p-4 shadow-lg",children:[e.jsxs("div",{className:"joyride-report flex gap-2 border-b border-gray-300",children:[e.jsx("div",{onClick:()=>v(!0),className:`transform cursor-pointer text-center text-sm font-semibold transition-all duration-300 md:text-base ${y?"scale-105 border-b-2 border-[#607196] text-[#607196]":"text-gray-400"} px-2 py-1 md:px-4 md:py-2`,children:"進行中"}),e.jsx("div",{onClick:()=>v(!1),className:`transform cursor-pointer text-center text-sm font-semibold transition-all duration-300 md:text-base ${y?"text-gray-400":"scale-105 border-b-2 border-[#607196] text-[#607196]"} px-2 py-1 md:px-4 md:py-2`,children:"已結束"})]}),y?e.jsx(e.Fragment,{children:e.jsxs(F,{className:"flex items-center justify-center gap-1 md:gap-2",variant:"grey",onClick:()=>r(),children:[e.jsx("p",{className:"hidden text-sm md:block md:text-base",children:"使用教學"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"yellow",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})})]})}):e.jsx(e.Fragment,{})]}),e.jsxs("div",{className:"joyride-project flex w-full flex-wrap gap-4",children:[y?e.jsxs(e.Fragment,{children:[" ",e.jsxs("div",{className:"joyride-addproject relative h-[200px] w-full md:h-[300px] md:w-[32%]",children:[e.jsx("div",{className:"h-[200px] w-full rounded-lg bg-slate-500 p-4 opacity-20 md:h-[300px]"}),e.jsx("button",{onClick:V,className:"absolute left-1/2 top-1/2 flex -translate-x-1/2 -translate-y-1/2 transform items-center justify-center text-5xl font-semibold opacity-100 md:h-[100px] md:w-[100px] md:text-7xl",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor",className:"size-20",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})})]})]}):e.jsx(e.Fragment,{}),l.length===0?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:l.filter(g=>y?g.isediting:!g.isediting).sort((g,L)=>{const S=g.created_at?g.created_at.seconds:0;return(L.created_at?L.created_at.seconds:0)-S}).map(g=>e.jsxs("div",{className:`border-1 relative flex h-[200px] w-full flex-col items-center justify-center gap-4 rounded-lg md:h-[300px] md:w-[32%] ${g.isediting?"bg-[#82A0BC]":"bg-[#A7CCED]"} p-3 shadow-md`,onClick:()=>re(g,g.id),children:[g.imageUrl&&e.jsx("img",{src:g.imageUrl,alt:"離線時無法載入圖片",className:"w-full overflow-hidden rounded-lg object-cover"}),e.jsx("p",{className:"text-xl font-semibold",children:g.name})]},g.id))})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75 fade-in",children:e.jsxs("div",{className:"relative flex w-[90%] max-w-lg flex-col gap-3 rounded-lg bg-white p-8",children:[e.jsx(F,{onClick:J,className:"self-end",children:"取消"}),e.jsxs("form",{onSubmit:A(Z),className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"flex w-full items-center gap-3",children:[e.jsx("div",{className:"text-nowrap font-semibold",children:"專案名稱"}),e.jsx("input",{className:"h-[48px] w-full rounded-lg border border-gray-300 px-4 py-2",type:"text",placeholder:"專案名稱",...O("projectname",{required:"請輸入專案名稱",maxLength:{value:10,message:"專案名稱不能超過 10 個字"}})})]}),k.projectname&&e.jsx("p",{className:"text-red-500",children:k.projectname.message})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-nowrap font-semibold",children:"專案圖片"}),e.jsx("input",{className:"w-full rounded-lg border border-gray-300 px-4 py-2",type:"file",accept:"image/*",...O("projectimage",{required:"上傳圖片"}),onChange:H})]}),c&&e.jsx("img",{src:c,alt:"Image Preview",className:"mt-4 h-32 w-32 object-cover"}),e.jsx("button",{disabled:C,type:"submit",className:"mt-4 self-center rounded-lg bg-[#607196] px-4 py-2 text-white",children:"新增專案"})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75 p-2 fade-in md:p-0",children:e.jsxs("div",{className:"relative flex w-[2000px] max-w-lg flex-col gap-3 rounded-lg bg-white p-6",children:[e.jsx(F,{onClick:ee,className:"self-end",children:"取消"}),e.jsxs("div",{className:"flex flex-col items-center gap-2 overflow-scroll",children:[e.jsx("p",{className:"mt-4 text-xl font-semibold",children:o.name}),e.jsxs("p",{className:"font-base mb-4 mt-4 text-xl",children:["總計 NT$",d]}),e.jsx("div",{className:"flex w-full flex-col gap-3",children:Array.isArray(u)&&u.map(g=>e.jsx(ze,{item:g,showProject:!1},g.id))}),e.jsxs("div",{className:"flex gap-2",children:[o.isediting&&e.jsx(F,{onClick:()=>ce(o.id),className:"mt-4",variant:"dontdelete",children:"結束專案"}),e.jsx(F,{onClick:()=>N(!0),variant:"delete",className:"mt-4",children:"刪除專案"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-70 p-4 fade-in",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-4",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"確認刪除所有的資料將移除"}),e.jsxs("div",{className:"flex justify-around",children:[e.jsx(F,{variant:"dontdelete",onClick:()=>{X("保留帳單",o.id),N(!1)},children:"保留所有帳單"}),e.jsx(F,{variant:"delete",onClick:()=>{X("刪除帳單",o.id),N(!1)},children:"我要刪除"}),e.jsx(F,{onClick:()=>N(!1),children:"取消"})]})]})})]})}function rr(){const[s,r]=a.useState(!0),{projectData:l}=P(),[i,n]=a.useState(!0);return a.useEffect(()=>{if(Array.isArray(l)&&l.length===0&&i){const t=setTimeout(()=>{r(!1),n(!1)},2500);return()=>clearTimeout(t)}else Array.isArray(l)&&l.length>0&&(r(!1),n(!1))},[l]),s&&i?e.jsx("div",{className:"w-full pt-5",children:e.jsxs("div",{className:"mx-auto mb-[10vh] flex w-[85%] flex-col pl-11 md:pl-0",children:[e.jsx(K,{height:72,width:"100%"}),e.jsxs("div",{className:"mt-2 flex w-full flex-col gap-2 md:flex-row",children:[e.jsx("div",{className:"w-full md:w-[450px]",children:e.jsx(K,{height:300,w:"100%"})}),e.jsx("div",{className:"w-full md:w-[450px]",children:e.jsx(K,{height:300,w:"100%"})})]})]})}):e.jsx("div",{className:"flex w-full justify-center bg-gradient-to-r from-[#e3e3e3] via-[#efefef] to-[#e3e3e3] pl-11 fade-in md:pl-0",children:e.jsx(sr,{})})}function Ve({account_type:s,bgColor:r,setIsAddNewOpen:l,setAlertMessage:i}){const[n,t]=a.useState(!1),{loginEmail:c}=P(),{propertyCollectionRef:m}=ne(c),{register:o,handleSubmit:x,reset:u,formState:{errors:D}}=Ae({defaultValues:{account:""}}),d=()=>{t(!0),l(!0)},f=()=>{t(!1),l(!1),u()},p=async N=>{try{l(!1),u(),t(!1);const C=await ye(m,{account:N.account,account_type:s,balance:Number(N.balance),created_at:lt()});await xe(C,{id:C.id}),i("新增成功")}catch(C){console.error("Error adding document: ",C)}};return Ve.propTypes={account_type:w.string.isRequired,bgColor:w.string.isRequired,setIsAddNewOpen:w.func.isRequired,setAlertMessage:w.func.isRequired},e.jsx(e.Fragment,{children:e.jsxs(F,{variant:`${r}`,className:"sticky bottom-0 right-0 w-full",children:[e.jsxs("p",{onClick:d,className:"flex items-center justify-center rounded-2xl",children:["新增",s,"帳戶"]}),n&&e.jsx("form",{onSubmit:x(p),children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75 text-black fade-in",children:e.jsxs("div",{className:"relative flex w-[90%] max-w-lg flex-col gap-3 rounded-lg bg-white p-8 opacity-100",children:[e.jsx(F,{className:"absolute right-3 top-3 mr-2",onClick:f,children:"取消"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold",children:"帳戶名稱"}),e.jsx("input",{className:"rounded-lg border border-gray-300 px-4 py-2",type:"text",placeholder:"帳戶名稱",...o("account",{required:"請輸入帳戶名稱",maxLength:{value:10,message:"名稱須小於 10 個字"}})}),D.account&&e.jsx("p",{className:"text-red-500",children:D.account.message})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold",children:"初始金額"}),e.jsx("input",{className:"rounded-lg border border-gray-300 px-4 py-2",type:"number",placeholder:"初始金額",...o("balance",{required:"請輸入初始金額",valueAsNumber:!0,max:{value:1e11,message:"須小於一千億"},validate:N=>!isNaN(N)||"請輸入有效的數字"})}),D.balance&&e.jsx("p",{className:"text-red-500",children:D.balance.message})]}),e.jsx(F,{type:"submit",variant:"add",children:"新增"})]})})})]})})}function Re({title:s,imageSrc:r,accountType:l,bgColor:i,textColor:n}){const{property:t,transactionData:c}=P(),[m,o]=a.useState(null),[x,u]=a.useState([]),[D,d]=a.useState(!1),[f,p]=a.useState(null),{loginEmail:N}=P(),{accountingCollectionRef:C,propertyCollectionRef:h}=ne(N),j=Array.isArray(t)?t.filter(b=>b.account_type===l).sort((b,k)=>{const E=b.created_at?b.created_at.seconds:0;return(k.created_at?k.created_at.seconds:0)-E}):[],R=b=>{o(b)},T=()=>{o(null),u([])},[M,O]=a.useState(!1),A=async b=>{try{if(b==="保留帳單")p("帳戶已刪除"),o(null),u([]),O(!1),await ge(ie(h,m.id));else if(b==="刪除帳單"){o(null),u([]),p("帳戶及其所有帳單已刪除"),O(!1);const k=oe(C,_("accountid","==",m.id));(await ae(k)).forEach(async I=>{await ge(ie(C,I.id))}),await ge(ie(h,m.id))}}catch(k){console.error(k)}};return a.useEffect(()=>{if(m){const b=c.filter(k=>k.accountid===m.id);b.sort((k,E)=>E.time.toDate()-k.time.toDate()),u(b)}},[m,c]),!j||j.length===0?e.jsxs(e.Fragment,{children:[f&&e.jsx(he,{message:f,onClose:()=>p(null)}),e.jsxs("div",{className:"flex h-[300px] w-full items-center justify-center rounded-lg border bg-slate-500 bg-opacity-40 p-6 text-white md:h-[595px]",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 size-10",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("div",{className:`relative h-11 w-32 text-nowrap opacity-100 ${M?"z-10":""}`,children:e.jsx(Ve,{account_type:l,bgColor:"default",setIsAddNewOpen:O,alertMessage:f,setAlertMessage:p})})]})]}):e.jsxs("div",{className:"flex h-auto w-full flex-col items-center rounded-lg bg-[#fcfcfc] px-4 py-7 shadow-lg md:h-[595px]",children:[f&&e.jsx(he,{message:f,onClose:()=>p(null)}),e.jsxs("div",{className:"relative mb-4 flex w-full items-center justify-center gap-3",children:[e.jsx("div",{className:"",children:r}),e.jsx("div",{className:"text-xl font-semibold",children:s})]}),e.jsx("div",{className:"relative flex h-full w-full flex-col gap-2 overflow-scroll",children:j.map(b=>e.jsxs("div",{className:`flex h-[88px] w-full items-center justify-between rounded-lg p-3 ${i}`,children:[e.jsxs("div",{className:`${n}`,children:[e.jsx("div",{className:"text-xl font-semibold",children:b.account}),e.jsx("div",{className:"h-1 w-6 rounded-lg bg-[#031926]"}),e.jsxs("div",{className:"text-xl",children:["NT$",b.balance.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-5 cursor-pointer",onClick:()=>R(b),children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]})]},b.id))}),e.jsx("div",{className:`w-full pt-5 ${M?"z-10":""}`,children:e.jsx(Ve,{account_type:l,bgColor:"add",show:!0,setIsAddNewOpen:O,alertMessage:f,setAlertMessage:p})}),m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-70 p-4",children:e.jsxs("div",{className:"h-[80vh] w-full max-w-lg overflow-scroll rounded-lg bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold",children:[m.account," 歷史紀錄"]}),e.jsxs("div",{children:[e.jsx(F,{onClick:()=>d(!0),variant:"delete",className:"mr-2",children:"刪除帳戶"}),e.jsx(F,{onClick:T,children:"取消"})]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:x==null?void 0:x.map(b=>e.jsx(ze,{item:b,showTime:!0},b.id))})]})}),D&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-70 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-4",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"確定要刪除帳戶嗎？"}),e.jsxs("div",{className:"flex justify-around",children:[e.jsx(F,{variant:"dontdelete",onClick:()=>{A("保留帳單"),d(!1)},children:"保留所有帳單"}),e.jsx(F,{variant:"delete",onClick:()=>{A("刪除帳單"),d(!1)},children:"刪除所有帳單"}),e.jsx(F,{onClick:()=>d(!1),children:"取消"})]})]})})]})}Re.propTypes={title:w.string.isRequired,imageSrc:w.string.isRequired,accountType:w.string.isRequired,bgColor:w.string.isRequired,textColor:w.string.isRequired};const ar=()=>{const{run:s,steps:r,stepIndex:l,setStepIndex:i,setRun:n}=pe(),{setAccounting:t}=P();a.useEffect(()=>{localStorage.getItem("hasSeenTutorial")?(n(!1),i(0)):n(!0)},[n,i]);const c=m=>{const{action:o,index:x,status:u,type:D,lifecycle:d}=m;if(u==="finished"||u==="skipped"||D==="close"||o==="close"&&d==="complete")n(!1),i(0),t(!1),localStorage.setItem("hasSeenTutorial","true");else if(D==="step:after"&&(o==="next"||o==="prev")){const f=x+(o==="next"?1:-1);switch(i(f),f){case 1:o==="prev"&&t(!1);break;case 2:o==="next"?(t(!0),setTimeout(()=>{n(!0)},500)):o==="prev"&&(t(!0),setTimeout(()=>{n(!0)},500));break;case 3:o==="next"?(t(!0),setTimeout(()=>{n(!0)},500)):o==="prev"&&(t(!0),setTimeout(()=>{n(!0)},500));break;case 4:o==="next"?t(!1):o==="prev"&&t(!0);break}}};return e.jsx(Ee,{run:s,steps:r,stepIndex:l,continuous:!0,showSkipButton:!0,callback:c,disableBeacon:!0,disableScrolling:!0,spotlightClicks:!1,disableOverlayClose:!0,styles:{options:{zIndex:1e4,arrowColor:"#f2f2f2",backgroundColor:"#f2f2f2",textColor:"#333",overlayColor:"rgba(0, 0, 0, 0.5)",primaryColor:"#4a90e2",placement:"bottom"},spotlight:{borderRadius:"8px"},tooltip:{fontSize:"18px",fontWeight:"bold",backgroundColor:"#f2f2f2",borderRadius:"8px",color:"#333",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"},buttonNext:{backgroundColor:"#607196",color:"#fff",borderRadius:"8px"},buttonBack:{color:"#888",marginRight:"10px"},buttonSkip:{color:"#f03e3e"}}})};function nr(){const{historyData:s}=P(),[r,l]=a.useState(null);if(a.useEffect(()=>{if(s&&s.length>0){const n=[...s].sort((u,D)=>u.time.toDate()-D.time.toDate()),t=n.map(u=>u.time.toDate().toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"})),c=n.map(u=>u.expense),m=n.map(u=>u.investment),o=n.map(u=>u.saving),x=n.map(u=>u.totalAssets);l({labels:t,datasets:[{label:"消費帳 (NT$)",data:c,fill:!0,borderColor:"#9dbebb",backgroundColor:"rgba(157, 190, 187, 0.3)",tension:.4},{label:"投資帳 (NT$)",data:m,fill:!0,borderColor:"#babfd1",backgroundColor:"rgba(186, 191, 209, 0.3)",tension:.4},{label:"儲蓄 (NT$)",data:o,fill:!0,borderColor:"#82A0BC",backgroundColor:"rgba(130, 160, 188, 0.3)",tension:.4},{label:"總資產 (NT$)",data:x,fill:!1,borderColor:"#4BC0C0",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:2,tension:.4}]})}},[s]),!r)return e.jsx("div",{children:"Loading chart..."});const i={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1},zoom:{pan:{enabled:!0,mode:"x"},zoom:{enabled:!0,mode:"x",speed:.1}},tooltip:{titleFont:{size:18},bodyFont:{size:16}},legend:{display:!0,labels:{font:{size:16}}}},scales:{x:{title:{display:!0,text:"時間",font:{size:18}},ticks:{font:{size:16},padding:10}},y:{title:{display:!0,text:"資產 (NT$)",font:{size:16}},ticks:{font:{size:16}},beginAtZero:!0}}};return e.jsx("div",{className:"relative w-full rounded-lg px-4 py-7",children:e.jsx("div",{className:"h-[600px]",children:e.jsx(dt,{data:r,options:i,plugins:[mt,$e]})})})}function lr(){const{setRun:s}=pe(),{property:r}=P(),{historyData:l}=P(),[i,n]=a.useState(null),{loginEmail:t}=P(),{historyCollectionRef:c}=ne(t),[m,o]=a.useState(!0),[x,u]=a.useState(!0);a.useEffect(()=>{if(Array.isArray(r)&&r.length===0&&x){const h=setTimeout(()=>{o(!1),u(!1)},2500);return()=>clearTimeout(h)}else Array.isArray(r)&&r.length>0&&(o(!1),u(!1))},[r]),a.useEffect(()=>{m||localStorage.getItem("hasSeenTutorial")||(s(!0),localStorage.setItem("hasSeenTutorial","true"))},[s,m]);const D=async()=>{if(r.length===0){n("尚未有資產，無法統計");return}const j=Object.fromEntries(Object.entries({saving:"儲蓄",expense:"消費",investment:"投資"}).map(([M,O])=>[M,r.filter(A=>A.account_type===O).reduce((A,b)=>A+(b.balance||0),0)])),R=r.reduce((M,O)=>M+(O.balance||0),0),T=Object.values(j).reduce((M,O)=>M+Math.abs(O),0);try{n("添加成功"),await ye(c,{saving:j.saving,expense:j.expense,investment:j.investment,totalAssets:R,totalAssetsAbsoluteValue:T,time:new Date})}catch(M){console.error("Error adding document: ",M)}},d=async h=>{try{const j=ie(de,"record",t,"history",h);n("刪除成功"),await ge(j)}catch(j){console.error(j)}},f=(h,j)=>j?Math.abs(h)/Math.abs(j)*100:0,p=()=>{s(!0)},[N,C]=a.useState(!0);return m&&x?e.jsx("div",{className:"w-full pt-5",children:e.jsxs("div",{className:"mx-auto mb-[10vh] flex w-[85%] flex-col pl-11 md:pl-0",children:[e.jsx(K,{height:72,width:"100%"}),e.jsxs("div",{className:"mt-2 flex w-full flex-col gap-2 md:flex-row",children:[e.jsx("div",{className:"h-[300px] w-full md:h-[595px]",children:e.jsx(K,{height:"100%",width:"100%"})}),e.jsx("div",{className:"h-[300px] w-full md:h-[595px]",children:e.jsx(K,{height:"100%",width:"100%"})}),e.jsx("div",{className:"h-[300px] w-full md:h-[595px]",children:e.jsx(K,{height:"100%",width:"100%"})})]}),e.jsx(K,{height:200,width:"100%",className:"mt-3"})]})}):e.jsx("div",{className:"w-full bg-gradient-to-r from-[#e3e3e3] via-[#efefef] to-[#e3e3e3] pl-11 pt-5 fade-in md:pl-0",children:e.jsxs("div",{className:"mx-auto mb-[10vh] flex w-[85%] flex-col",children:[i&&e.jsx(he,{message:i,onClose:()=>n(null)}),e.jsx(ar,{}),e.jsxs("div",{className:"mb-3 flex w-full justify-end rounded-lg bg-[#fcfcfc] p-4 shadow-lg",children:[e.jsxs(F,{className:"mr-2 flex items-center justify-center gap-1 md:gap-2",variant:"grey",onClick:()=>p(),children:[e.jsx("button",{className:"hidden text-sm md:block md:text-base",children:"使用教學"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"yellow",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 1 0-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})})]}),e.jsxs(F,{variant:"retain",onClick:D,className:"joyride-totalproperty flex items-center justify-center gap-1 md:gap-2",children:[e.jsx("p",{className:"hidden text-sm md:block md:text-base",children:"統計最新資產"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-4 md:size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})]})]}),e.jsxs("div",{className:"joyride-account flex h-full flex-col items-center justify-center gap-3 md:flex-row md:flex-nowrap",children:[e.jsx("div",{className:"joyride-saving-account w-full",children:e.jsx(Re,{title:"儲蓄",imageSrc:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#e8e9ed",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z"})}),accountType:"儲蓄",bgColor:"bg-[#e8e9ed]"})}),e.jsx("div",{className:"joyride-expense-account w-full",children:e.jsx(Re,{title:"消費",imageSrc:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#9dbebb",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),accountType:"消費",bgColor:"bg-[#9dbebb]",textColor:"text-gray-800"})}),e.jsx("div",{className:"joyride-investment-account w-full",children:e.jsx(Re,{title:"投資",imageSrc:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#babfd1",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5m.75-9 3-3 2.148 2.148A12.061 12.061 0 0 1 16.5 7.605"})}),accountType:"投資",bgColor:"bg-[#babfd1]"})})]}),e.jsx("div",{className:"mx-auto w-full",children:l.length!==0?e.jsxs("div",{className:"mb-9 mt-3 flex h-auto w-full flex-col items-center overflow-y-scroll rounded-lg bg-[#fcfcfc] px-4 pb-7 shadow-lg lg:max-h-[750px]",children:[e.jsxs("div",{className:"sticky top-0 flex w-full items-center justify-center bg-[#fcfcfc] pb-2 pt-7",children:[e.jsx("div",{className:"mr-2 text-lg font-semibold md:mr-0 md:text-xl",children:"資產紀錄"}),e.jsxs("div",{className:"right-3 flex gap-2 border-b border-gray-300 md:absolute",children:[e.jsx("button",{onClick:()=>C(!0),className:`text-sm font-semibold md:text-base ${N?"scale-105 border-b-2 border-[#607196] text-[#607196]":"text-gray-400"} transform px-2 py-1 transition duration-300 ease-in-out md:px-4 md:py-2`,children:"列表檢視"}),e.jsx("button",{onClick:()=>C(!1),className:`text-sm font-semibold md:text-base ${N?"text-gray-400":"scale-105 border-b-2 border-[#607196] text-[#607196]"} transform px-2 py-1 transition duration-300 ease-in-out md:px-4 md:py-2`,children:"圖表檢視"})]})]}),e.jsx("div",{className:"flex h-[500px] w-full flex-col overflow-y-scroll lg:h-auto",children:N?l.slice().sort((h,j)=>j.time.toDate()-h.time.toDate()).map(h=>e.jsxs("div",{className:"m-1 flex h-fit w-full flex-col items-center gap-3 rounded-lg p-2 md:flex-row lg:min-h-[100px]",children:[e.jsx("div",{className:"w-[110px] rounded-lg p-2 text-center",children:h.time.toDate().toLocaleDateString()}),e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx("div",{className:"flex h-6 items-center justify-center rounded-lg bg-[#e8e9ed] font-semibold",style:{width:`${f(h.saving,h.totalAssetsAbsoluteValue)}%`},"data-tooltip-id":"tooltip","data-tooltip-content":`儲蓄帳戶 NT$${h.saving.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})} (${f(h.saving,h.totalAssetsAbsoluteValue).toFixed(1)}%)`}),e.jsx("div",{className:"flex h-6 w-full items-center justify-center rounded-lg bg-[#9dbebb] font-semibold text-white",style:{width:`${f(h.expense,h.totalAssetsAbsoluteValue)}%`},"data-tooltip-id":"tooltip","data-tooltip-content":`消費帳戶 NT$${h.expense.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})} (${f(h.expense,h.totalAssetsAbsoluteValue).toFixed(1)}%)`}),e.jsx("div",{className:"flex h-6 items-center justify-center rounded-lg bg-[#babfd1] font-semibold",style:{width:`${f(h.investment,h.totalAssetsAbsoluteValue)}%`},"data-tooltip-id":"tooltip","data-tooltip-content":`投資帳戶 NT$${h.investment.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})} (${f(h.investment,h.totalAssetsAbsoluteValue).toFixed(1)}%)`}),e.jsx(ys,{id:"tooltip"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-end gap-2 lg:flex-row",children:[e.jsxs("div",{className:"ml-2 flex h-[60px] min-w-[150px] flex-col items-center justify-center rounded-lg border-2 border-[#e8e9ed] p-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"儲蓄"}),e.jsxs("div",{children:["NT$",h.saving.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"ml-2 flex h-[60px] min-w-[150px] flex-col items-center justify-center rounded-lg border-2 border-[#9dbebb] p-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"消費"}),e.jsxs("div",{children:["NT$",h.expense.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"ml-2 flex h-[60px] min-w-[150px] flex-col items-center justify-center rounded-lg border-2 border-[#babfd1] p-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"投資"}),e.jsxs("div",{children:["NT$",h.investment.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"ml-2 flex h-[60px] min-w-[150px] flex-col items-center justify-center rounded-lg p-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"總資產"}),e.jsxs("div",{children:["NT$",h.totalAssets.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsx(F,{onClick:()=>d(h.id),variant:"delete",className:"flex-col items-center justify-center text-nowrap",children:"刪除"})]})]},h.id)):e.jsx(nr,{})})]}):e.jsxs("div",{className:"mb-4 mt-3 flex h-[200px] w-full items-center justify-center rounded-lg border bg-slate-500 text-white opacity-40",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"mb-2 size-10",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),e.jsx("p",{className:"ml-4 cursor-pointer font-semibold",onClick:D,children:"統計資產，即可查看分析圖表"})]})})]})})}function or(){return e.jsx(e.Fragment,{children:e.jsx(lr,{})})}const we=({children:s})=>{const{loginEmail:r}=P();return!!r?s:e.jsx(it,{to:"/",replace:!0})};we.propTypes={children:w.node.isRequired};const ir=_t.createRoot(document.getElementById("root"));ir.render(e.jsx(ht,{children:e.jsx(Es,{children:e.jsx(Zt,{children:e.jsxs(is,{children:[e.jsx(ve,{path:"/",element:e.jsx(er,{})}),e.jsxs(ve,{path:"/",element:e.jsx(we,{children:e.jsx(Ms,{})}),children:[e.jsx(ve,{path:"/accounting",element:e.jsx(we,{children:e.jsx(Fs,{})})}),e.jsx(ve,{path:"/analysis",element:e.jsx(we,{children:e.jsx(qs,{})})}),e.jsx(ve,{path:"/property",element:e.jsx(we,{children:e.jsx(or,{})})}),e.jsx(ve,{path:"/project",element:e.jsx(we,{children:e.jsx(rr,{})})}),e.jsx(ve,{path:"*",element:e.jsx(it,{to:"/accounting",replace:!0})})]})]})})})}));
